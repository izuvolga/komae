# User Interface

##  Overview

本ソフトウェアは3つのパネルで構成されている。
- Asset Library（左パネル）
- Spread Sheet（中央パネル）
- Preview Window（右パネル）

各パネルは表示/非表示を切り替えることができ、動的なレイアウト調整により効率的な作業スペースを提供する。

### 基本レイアウト（全パネル表示）
```
   ┌─────────────────┬──────────────────────────────┬─────────────────┐
   │ [◄] Asset       │        Project Heade         │    Preview [►]  │
   │                 ├──────────────────────────────┤                 │
   │                 │                              │                 │
   │  Asset Library  │       Spread Sheet           │  Preview Window │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   └─────────────────┴──────────────────────────────┴─────────────────┘
```

### 片方非表示レイアウト
```
   ┌─────────────────────────────────────────────┬─────────────────┐
   │ [◄]             Project Header              │    Preview [►]  │
   │                                             ├─────────────────┤
   │                                             │                 │
   │            Spread Sheet                     │  Preview Window │
   │                                             │                 │
   │                                             │                 │
   │                                             │                 │
   │                                             │                 │
   │                                             │                 │
   │                                             │                 │
   │                                             │                 │
   │                                             │                 │
   └─────────────────────────────────────────────┴─────────────────┘
```

### フルスクリーンレイアウト（両パネル非表示）
```
   ┌─────────────────────────────────────────────────────────────┐
   │ [◄]             Project Header                       [►]    │
   ├─────────────────────────────────────────────────────────────┤
   │                                                             │
   │                     Spread Sheet                            │
   │                                                             │
   │                                                             │
   │                                                             │
   │                                                             │
   │                                                             │
   │                                                             │
   │                                                             │
   │                                                             │
   └─────────────────────────────────────────────────────────────┘
```

Created by [Ascii Flow](https://asciiflow.com/#/)

## Menu Bar

OS 提供のメニューバーが存在し、そこから新規プロジェクトの作成や、プロジェクトの保存、エクスポートなどを行うことができる。

- Extension
  - Custom Fonts
  - Custom Assets (予定)
- File
  - New Project
  - Open Project
  - Save Project
  - Export Project
- Edit
  - Undo
  - Redo
  - Cut
  - Copy
  - Paste
- Help
  - Documentation
  - Release Notes

## Project Header

```
   ┌─────┬──────────┬─────────┬─────────┬───┬─────────────────────────┬─────┐
   │ [◄] │   P:[🖊️] │ [JA|▼]  │  T:[🖊️] │ F │                         │ [►] │
   ├─────┴──────────┴─────────┴─────────┴───┴─────────────────────────┴─────┤
```

Project Header は、プロジェクト全体に横断した設定や表示設定をするためのボタンが配置される。
- `[◄]` はアセットライブラリを表示するためのトグルボタンで、クリックすると左パネルの Asset Library の表示/非表示を切り替える。
- `[►]` はプレビューウィンドウを表示するためのトグルボタンで、クリックすると右パネルの Preview Window の表示/非表示を切り替える。
- `P:[🖊️]` は、プロジェクト全体の設定の編集を画面を表示する。表示されるウィンドウは「Project Creation」とほぼ同じものだが、「作成」ではなく「更新」ボタンになる。実際には`P`は P のアイコン
- `T:[🖊️]` を押下すると「TextAsset Bulk Edit Screen」が表示される。後述。
- `[JA|▼]` は、プロジェクトの言語コードを選択するためのドロップダウンメニューで、現在の言語コードが表示される。プロジェクト作成時に指定した言語コードが表示される。言語コードを選択すると、Spread Sheet に存在する全ての TextAssetInstance の言語が切り替わる。
- `F` をクリックすると、Custom Fonts の画面が開く

## Project Creation

```
    ┌────────────────────────────────────────┐
    │  Project Name                          │
    │  ┌──────────────────────────────────┐  │
    │  │                                  │  │
    │  └──────────────────────────────────┘  │
    │  Description                           │
    │  ┌──────────────────────────────────┐  │
    │  │                                  │  │
    │  │                                  │  │
    │  │                                  │  │
    │  │                                  │  │
    │  └──────────────────────────────────┘  │
    │             ┌────────────────┬───┐     │
    │   Lang      │ JA (Japanese)  │ v │[?]  │
    │             └────────────────┴───┘     │
    │   ┌────────────────────────────────┐   │
    │   │┌──┬─┐┌──┬─┐┌──┬─┐              │   │
    │   ││JA│x││EN│x││ZH│x│              │   │ <-- Lang Code Box
    │   │└──┴─┘└──┴─┘└──┴─┘              │   │
    │   │                                │   │
    │   └────────────────────────────────┘   │
    │  Canvas Size                           │
    │  ┌──────────────────────────────────┐  │
    │  │ o 縦長(3:4)                      │  │
    │  └──────────────────────────────────┘  │
    │  ┌──────────────────────────────────┐  │
    │  │ o 縦長(9:16)                     │  │
    │  └──────────────────────────────────┘  │
    │  ┌──────────────────────────────────┐  │
    │  │ o 横長(4:3)                      │  │
    │  └──────────────────────────────────┘  │
    │  ┌──────────────────────────────────┐  │
    │  │ o 横長(16:9)                     │  │
    │  └──────────────────────────────────┘  │
    │  ┌──────────────────────────────────┐  │
    │  │ o スクエア                       │  │
    │  └──────────────────────────────────┘  │
    │  ┌──────────────────────────────────┐  │
    │  │ o カスタム                       │  │
    │  └──────────────────────────────────┘  │
    │                           ┌────────┐   │
    │                           │  作成  │   │
    │                           └────────┘   │
    └────────────────────────────────────────┘
```

Lang Code は、プロジェクトの言語コードを選択するためのもので、JA（日本語）、EN（英語）、ZH（中国語）などが選べる。
`[?]` ボタンをクリックすると、この Lang の説明がポップアップで表示される。
この言語コードは、TextAsset が持つ状態の一部であり、作品の対応言語を示す。

ISO 639-1 の言語コード一覧がプルダウンで表示され、クリックすると Lang Code Box に追加がされる。
複数の言語を登録することができ、Lang Code Box に追加される。`x`はバツのボタンで、クリックするとその言語コードを Lang Code Box から削除する。Lang Code Box にマウスカーソルをホバーすると、その言語コードの説明がポップアップで表示される。


## Panel Toggle System

### Dynamic Button Positioning

各パネルの表示切り替えボタンは、表示状態に応じて動的に位置を変更する：

#### Asset Library Toggle
- **閉じるボタン**：アセットライブラリ内のヘッダー左側
- **開くボタン**：中央パネルのツールバー左側（プロジェクト名の左）

#### Preview Window Toggle  
- **閉じるボタン**：プレビューウィンドウ内のヘッダー右側
- **開くボタン**：中央パネルのツールバー右側（プロジェクト名の右）

### SVG Icons

パネル切り替えボタンには、以下のSVGアイコンを使用：
- `PanelCollapseLeftIcon`：アセットライブラリ閉じるボタン
- `PanelExpandLeftIcon`：アセットライブラリ開くボタン  
- `PanelCollapseRightIcon`：プレビューウィンドウ閉じるボタン
- `PanelExpandRightIcon`：プレビューウィンドウ開くボタン
- `FitToViewIcon`：プレビューウィンドウのフィット表示ボタン

アイコンは`currentColor`を使用してテーマ一貫性を保ち、ホバー効果にも対応している。

## Asset Window

  - Asset（テンプレート）を管理する場所。entity.md参照。
  - 画像ファイルをドラッグアンドドロップしたり、メニューバーから新規作成したりすることで Asset を追加することができる。
  - Asset のアイコンは以下の様になる
    - ImageAsset ... 登録されている画像を縮小したもの
    - TextAsset ... 「T」の文字が書かれたアイコン
  - パネルの表示/非表示切り替えボタンを備えている
  - **縦スクロール機能**：多数のアセットがある場合は自動的に縦スクロールバーが表示される

```
    ┌───────────────────┐
    │                   │
    │   ┌───────────┐   │
    │   │ Asset 1   │   │
    │   └───────────┘   │
    │   ┌───────────┐   │
    │   │ Asset 2   │   │
    │   └───────────┘   │ 
    │   ┌───────────┐   │
    │   │ Asset 3   │   │
    │   └───────────┘   │
    │   ┌───────────┐   │
    │   │ Asset 4   │   │
    │   └───────────┘   │
    │   ┌───────────┐   │
    │   │ Asset 5   │   │
    │   └───────────┘   │
    │       ...         │
    └───────────────────┘
```

### Asset Management

それぞれのアセットは、種類ごとに異なる特性を持つ。
Asset Window 上でダブルクリックすることで、画面全体がアセットの編集ウィンドウに切り替わる。

#### ImageAsset

最も本ソフトウェアで利用されるであろうアセット
Asset Window で画像ファイルをドラッグアンドドロップすることで作成される。
さらに Asset Window 上でダブルクリック、あるいは右クリックからメニューを出して「Edit」を選ぶと、詳細を編集するウィンドウが開く。以下のような感じ。

```
      ┌─────────────────────────────────────────────────────────────┐
      │                                                             │
      │                                   Asset Name                │
      │                                        ┌────────────────┐   │
      │                                        │                │   │
      │                                        └────────────────┘   │
      │    ┌─────────────────────┐        Original Width/Height     │
      │    │    Image Preview    │            ┌───────┐┌───────┐    │
      │    │                     │            │  100  ││   200 │    │
      │    │   o------------o    │            └───────┘└───────┘    │
      │    │   |            |    │        Default Width/Height      │
      │    │   |            |    │      [ ] 縦横比を元画像にあわせる│
      │    │   o------------o    │            ┌───────┐┌───────┐    │
      │    │                     │            │       ││       │    │
      │    │                     │            └───────┘└───────┘    │
      │    │                     │          Default PosX/PosY       │
      │    └─────────────────────┘            ┌───────┐┌───────┐    │
      │                                       │       ││       │    │
      │                                       └───────┘└───────┘    │
      │                                     Default Opacity         │
      │                                       o─[]────────────o     │
      │                                     Edit Mask [🖊️]          │
      └─────────────────────────────────────────────────────────────┘
```

Image Preview のフレームはキャンバスサイズの縦横比率にあわせて表示される。
Original Width/Height はグレーアウトしており、編集できない。
Original Width/Height のテキストボックスは、0以下の値を入力することはできない。
ただ、一時的に編集で空白にできる。が、マウスのフォーカスを外したときにバリデーションがされ、不正な値が入力されている場合は、元の値に戻される。
整数だけではなく、少数第2位までの数字を入力することができる。

Default Width/Height は、編集ができる項目で、ここで指定した値が ImageAsset のデフォルト値として保存される。
Default Width/Height のテキストボックスは、0以下の値を入力することはできるが、数字と`-`と`.`以外の文字は入力することはできない。
整数だけではなく、少数第2位までの数字を入力することができる。
ただ、一時的に編集で空白にできる。が、マウスのフォーカスを外したときにバリデーションがされ、不正な値が入力されている場合は、元の値に戻される。

「[ ] 縦横比を元画像にあわせる」のチェックボックスは、チェックを入れると、Default Width/Height の値を変更した際に、元画像の縦横比を維持するように自動的に計算される。Default PosX/PosY は、画像のデフォルトの位置を指定する項目で、ここで指定した値が ImageAsset のデフォルト値として保存される。

以下の領域は、マウスでのドラッグ操作で、画像の位置や大きさを変更することができる。
`o` の箇所はドラッグ可能なハンドルで、画像の位置や大きさを変更することができる。
実際に`o`の箇所は、画面上では四角形の図形として表示される。
この`o`の箇所をドラッグする最中に Shift キーを押すと、その時点のサイズの縦横比を維持したまま大きさを変更することができる。
矩形の内側は ImageAsset の画像が表示される領域で、画像の大きさや位置を確認することができる。
さらに矩形の内側自体もドラッグ可能で、画像の位置を変更することができる。

```
o------------o
|            |
|            |
o------------o
```

ペンのマークをクリックすると、下のマスク編集画面が開く。

マスク編集:
```
      ┌───────────────────────────────────────────────────────────┐
      │                                 Default Mask              │
      │    ┌─────────────────────┐      ┌───────┐      ┌───────┐  │
      │    │    Image Preview    │  P1:x│       │ P1:y │       │  │
      │    │                     │      └───────┘      └───────┘  │
      │    │   0------------0    │      ┌───────┐      ┌───────┐  │
      │    │   |            |    │  P2:x│       │ P2:y │       │  │
      │    │   |            |    │      └───────┘      └───────┘  │
      │    │   0------------0    │      ┌───────┐      ┌───────┐  │
      │    │                     │  P3:x│       │ P3:y │       │  │
      │    │                     │      └───────┘      └───────┘  │
      │    │                     │      ┌───────┐      ┌───────┐  │
      │    └─────────────────────┘  P4:x│       │ P4:y │       │  │
      │                                 └───────┘      └───────┘  │
      │                                                           │
      │                                Exit Mask Editor [<-]      │
      │                                                           │
      └───────────────────────────────────────────────────────────┘
```

マスク編集画面では、マスク領域を矩形で指定できる。
「Exit Mask Editor」をクリックすると、元の ImageAsset 編集画面に戻る。
それぞれの座標のテキストボックスは、0以下の値を入力することはできるが、数字と`-`と`.`以外の文字は入力することはできない。
整数だけではなく、少数第2位までの数字を入力することができる。
ただ、一時的に編集で空白にできる。が、マウスのフォーカスを外したときにバリデーションがされ、不正な値が入力されている場合は、元の値に戻される。

このマスク編集画面では、画像の表示領域を矩形で指定することができる。
マスクの矩形は、4つのポイント（P1, P2, P3, P4）で定義され、それぞれの座標を指定することができる。
`0` の箇所は、マスクの矩形の角を表しており、ドラッグ操作で位置を変更することができる。
この画面を開いた時の P1〜P4 の座標はキャンバスサイズの４点になっている。

```
0------------0
|            |
|            |
0------------0
```

このマスクの編集画面の矩形の範囲にのみ、画像が表示されるようになる。
マスクの編集画面では、上記の矩形の外側の範囲は、薄い白色で表示され、マスクの範囲がわかりやすくなっている。以下のドットが薄い白色の範囲。
`+` で囲まれた部分がImageAssetの画像、`0` で囲まれた部分がマスクの矩形の範囲を表す。
重要なのは、ImageAssetの画像もしっかりと表示されていること。


```
┌───────────────────────────────┐
│...............................│
│...+----------------------+....│
│...|......................|....│
│...|....0------------0....|....│
│...|....|            |....|....│
│...|....|            |....|....│
│...|....0------------0....|....│
│...|......................|....│
│...+----------------------+....│
│...............................│
└───────────────────────────────┘
```

なお、マスクの四隅のデザインは簡略化のために`0`としてたが、
実際には以下のように矩形の内側に内接した四角形のような形状をしていることにする。

```
   ┌─────┐────────────────┌─────┐  
   │     │                │     │  
   └─────┘                └─────┘  
   │                            │  
   │                            │  
   │                            │  
   │                            │  
   │                            │  
   ┌─────┐                ┌─────┐  
   │     │                │     │  
   └─────┘────────────────└─────┘  
```


マスクのデフォルト値はキャンバスの四隅のため、上記のようなデザインにしないと初期位置からドラッグがしにくいためである。

## Spread Sheet Window

本ソフトウェアの特徴的な特性は、複数 Page での横断編集が極めて容易であること。
- UI 上の Spread Sheet には、Microsoft Excel のような格子状の表形式のエディタがあり、複数の Page にまたがる AssetInstance の情報を編集することができる。
- それぞれの行は Page を表し、列は Asset（テンプレート）を表す。
- ある Page で特定の AssetInstance を作成した場合、セルに元となった Asset の列が表示される。
- ページ管理機能が統合されており、従来の独立したPageListコンポーネントは不要になった。
- 例えば
  - Asset Window に画像ファイルをドロップして、「My Girl」という ImageAsset を作成
  - 「My Girl」をSpread Sheet にドロップする
  - すると、My Girl の列が Spread Sheet に追加される。
  - 各セルにはチェックボックスが表示され、チェックを入れることで AssetInstance を Page 上に配置することができる。
  - また、チェックボックス以外のセル内部の場所をクリックすることで、AssetInstance の個別設定（位置のオーバーライド、AssetAttr参照の変更、透明度調整など）を行うためのウィンドウがモーダルとして表示される
  - 列のタイトルをクリックすることで、Excel のように、列全体を選択することができる
  - 列のタイトルを右クリックすることで、非表示にすることができる。例えば背景画像など、常に表示して編集する必要がない場合は、非表示にしておくことができる。
  - 列をドラッグすることで、列の順番を変更することができる。
  - [+] ボタンをクリックすることで、新たにページを追加することができる。
  - Preview の列には各ページのプレビューが表示される。プレビューは、ページの内容を確認するためのもので、クリックすることで Preview Window でそのページが表示される。
  - `#` の列には、ページの番号が表示される。
    - この列の数字をクリックすると、そのページのタイトルを変更することができる。
    - テキストボックスが表示され、そこに新しいタイトルを入力することができる。
  - ページの順番は、Spread Sheet 上でドラッグアンドドロップで変更することができる。
  - `#` の列の左側にある `[x]` ボタンをクリックすることで、そのページを削除することができる。UI上はXボタンのように表示される。
  - **スクロール機能**：多数のページ・アセットがある場合は縦・横スクロールバーが表示される
  - **パン機能**：マウス中ボタン（ホイールボタン）を押しながらドラッグすることで自由自在にパン操作が可能
  - 各セルにある `[✔]` はチェックボックスで、その AssetInstance の表示の ON/OFF を切り替えらえっる。
  - 各セルにある `[%]` は編集ボタンで、そのボタンをクリックするとモーダルウィンドウが表示され、AssetInstance の個別設定を行うことができる。
    - 実際に `[%]` は本ドキュメントで便宜上表記しているもので、実際の UI では `🖊️` のようなペンのアイコンが表示される。

```
       #    Preview  My Girl        Background       Girls Speech     Effect
   ┌────────┬──────┬────────────────┬────────────────┬────────────────┬────────────────┐
   │        │      │ [✔] |          │ [✔] |          │ [✔] |          │ [✔] |          │
[x]│   1    │      │ [%] |          │ [%] |          │ [%] |          │ [%] |          │
   │        │      │     |          │     |          │     |          │     |          │
   ├────────┼──────┼────────────────┼────────────────┼────────────────┼────────────────┤
   │        │      │ [✔] |          │ [✔] |          │ [✔] |          │ [✔] |          │
[x]│   2    │      │ [%] |          │ [%] |          │ [%] |          │ [%] |          │
   │        │      │     |          │     |          │     |          │     |          │
   ├────────┼──────┼────────────────┼────────────────┼────────────────┼────────────────┤
   │        │      │ [✔] |          │ [✔] |          │ [✔] |          │ [✔] |          │
[x]│   3    │      │ [%] |          │ [%] |          │ [%] |          │ [%] |          │
   │        │      │     |          │     |          │     |          │     |          │
   ├────────┼──────┼────────────────┼────────────────┼────────────────┼────────────────┤
   │        │      │ [✔] |          │ [✔] |          │ [✔] |          │ [✔] |          │
[x]│   4    │      │ [%] |          │ [%] |          │ [%] |          │ [%] |          │
   │        │      │     |          │     |          │     |          │     |          │
   ├────────┴──────┴────────────────┴────────────────┴────────────────┴────────────────┤
   │                                           [+]                                     │
   └───────────────────────────────────────────────────────────────────────────────────┘
```


## Cell

それぞれのセルは、以下のようなレイアウトになっている。
左右に範囲が別れており、左右の領域が線で分割されている。
左側を cell-manage と呼ぶ
右側を cell-preview と呼ぶ。

- cell-manage にはチェックボックスと編集ボタンが縦に並んでいる。
- cell-content には、AssetInstance の種類ごとに内容が異なる領域。
- 基本的にはその AssetInstance の概要が表示される。
- セルの右上には右上のセルの頂点に内接する三角形が描画される `＼` は三角形の底辺を表す。実際の画面上は内接するように青い三角形が描画される。
  - この三角形は、そのセルが表す Asset の内容が AssetInstance 側で override されていることを示す。もしひとつでも Asset の属性が AssetInstance 側でオーバーライドされている場合は、この三角形が表示される。

```
cell-manage <- -> cell-content
        ┌────────────────┐
        │ [✔] |        ＼│
        │ [%] |          │
        │     |          │
        └────────────────┘
```

ImageAssetInstance の場合、cell-content にはその画像の小さなプレビューが表示される。

```
┌────────────────┐
│ [✔] |  ┌────┐  │
│ [%] |  │    │  │
│     |  └────┘  │
└────────────────┘
```

TextAssetInstance の場合、cell-content にはその Asset のテキスト (default_text ないし override_text) が表示される。SVG ではなくプレーンテキストで表示される。
クリックをするとテキストボックスとなり、値を直接編集できる。

```
┌────────────────┐
│ [✔] |HELLO     │
│ [%] |WORLD     │
│     |          │
└────────────────┘
```

ValueAssetInstance の場合、cell-content にはその ValueAsset の現在の値が表示される。
クリックをするとテキストボックスとなり、値を直接編集できる。
ただし ValueAsset が数式を持つ場合は、数式の結果が表示され、テキストボックスになったときは数式を編集できるようになる。

```
┌────────────────┐
│ [✔] |          │
│ [%] | 123      │
│     |          │
└────────────────┘
```



## Column

列のヘッダ部分を右クリックするとメニューが出現し、その列全体に対してバルク操作を行うことができる。
右クリックを開いている間、その列全体はハイライトされ、どの列に対して操作を行うかがわかりやすくなっている。
例えば、以下の例で、Background と書いてあるあたりを右クリックする

```
...+----------------+...
...| Background     |...
...┬────────────────┬...
...│ [✔] |          │...
...│ [%] |          │...
...│     |          │...
...┼────────────────┼...
...│ [✔] |          │...
...│ [%] |          │...
...│     |          │...
...┼────────────────┼...
...│ [✔] |          │...
...│ [%] |          │...
...│     |          │...
...┴────────────────┴...
```

と、ImageAsset の場合は以下のメニューが表示される。

- 列を非表示
   ... その列を非表示にする
- 全て表示
   ... 列の全てのセルに対してチェックボックスを ON にする
- 全て隠す
   ... 列の全てのセルに対してチェックボックスを OFF にする
- 全て変更リセット
   ... 列の全てのセルに対して個別設定をリセットする（Asset のデフォルト値に戻すため、AssetInstance の overwrite_... の属性は全て undefined になる）

### Hide/Show Column

「列を隠す」を選ぶと、その列は非表示になる。
例えば、以下のようなレイアウトで、列Bで列を隠すを選ぶと、

```
|  A  |  B  |  C  |  D  |
| --- | --- | --- | --- |
| ... | ... | ... | ... |
```

以下のように列Bが非表示になる。そして、その両側の列Aと列Cの間に「◀」「▶」のボタンが表示される。

```
|  A  ◀|▶ C  |  D  |
| ---  | --- | --- |
| ...  | ... | ... |
```

この「◀」「▶」のボタンをクリックすることで、非表示にした列Bを再度表示することができる。

### Column Drag/Drop

 - 列をドラッグしだすと、その列と同じサイズの黒い影のような列が新たに出現、マウスに追従する
 - マウスを横に動かすと、その列の新たな位置として期待される場所に、太めの縦線が入る

例えば、以下の A, B, C の列がある状況で、Bのヘッダ部分でマウスのクリックを押下するとします。

```
 |  A  |  B  |  C  |
 | --- | --- | --- |
 | ... | ... | ... |
 | ... | ... | ... |
```

すると、新たに B 列と同じサイズの透明な矩形が出現して、Bに覆い被さる。`/` が覆いかぶさるエリアで。

```
 |  A  |/////|  C  |
 | --- |/////| --- |
 | ... |/////| ... |
 | ... |/////| ... |
```

この矩形はマウスに横方向に関してのみ追従する。
矩形の左端が、 A の中心点よりも左側にくると、Aの左側の線が太くなり、そこに挿入できることがわかります。（以下の図は `$` が太線を表しています）

```
 $  A|///|B  |  C  |
 $ --|///|-- | --- |
 $ ..|///|.. | ... |
 $ ..|///|.. | ... |
```

逆に右側に移動すると、Cの右側の線が太くなります。

```
 |  A  |  B|///|C  $
 | --- | --|///|-- $
 | ... | ..|///|.. $
 | ... | ..|///|.. $
```


そして、そのタイミングでマウスのボタンを離すと、位置が入れ替わる。


```
 |  A  |  C  |  B  |
 | --- | --- | --- |
 | ... | ... | ... |
 | ... | ... | ... |
```


### Hide/Show + Drag/Drop

特定の列を非表示にしている状態で、列のドラッグを開始した場合の挙動を定義する。
以下のように、列A〜Eがある状況で、列C を非表示にしているとする。
ここで、列Eをドラッグしだす状況を考える。
Eの場合、新たな挿入位置として、1〜3の3箇所に設定できるようにする。

初期状態:
```
|  A  |  B ◀|▶ D  |  E  |
| --- | --- | --- | --- |
| ... | ... | ... | ... |
1     2     3     4     5
```

初期状態 から E を1の位置に挿入すると、以下のように、EがAの左側に移動する。

```
|  E  |  A  |  B ◀|▶ D  |
..中略..
```

初期状態 から E を2の位置に挿入すると、以下のように、EがBの左側に移動する。

```
|  A  |  E  |  B ◀|▶ D  |
..中略..
```

初期状態 から E を3の位置に挿入すると、以下のように、EはDの左側に移動する。
そして、▶のボタンは E のセルのヘッダに表示される。EとDのポジションが結果的に入れ替わったようになる。
Dのヘッダにはなにのボタンも表示されなくなる。

```
|  A  |  B ◀|▶ E  |  D  |
..中略..
```

初期状態 から E を4の位置に挿入しようとしても、位置は変わらない。

```
|  A  |  B ◀|▶ D  |  E  |
..中略..
```

つまり、非表示にされている列の位置には挿入できない。
また、非表示にされている連続している列は、再表示しない限り、挿入位置として認識されない。


## Row

行の先頭を右クリックしたら、列単位のバルク操作ができるようになる。
内容は、Column 単位のバルク操作と同様。
それに加えて「上に挿入」「下に挿入」「削除」のメニューも表示して、行の追加・削除ができるようにする。

- 行を非表示
   ... その行を非表示にする
- 全て表示
   ... 行の全てのセルに対してチェックボックスを ON にする
- 全て隠す
   ... 行の全てのセルに対してチェックボックスを OFF にする
- 全て変更リセット
   ... 行の全てのセルに対して個別設定をリセットする（Asset のデフォルト値に戻すため、AssetInstance の overwrite_... の属性は全て undefined になる）
- 上に挿入
   ... 行の上に新しい行を挿入する
- 下に挿入
   ... 行の下に新しい行を挿入する
- 削除
   ... 行を削除する。ページ番号は詰められ、削除された行の下の行は上に詰められる。

「行を表示」を選ぶと、その列は非表示になる。
例えば、以下のようなレイアウトで、行2で行を隠すを選ぶと、

```
      | 列A | 列B |
| --- | --- | --- |
|     | ... | ... |
| 行1 | ... | ... |
|     | ... | ... |
| --- | --- | --- |
|     | ... | ... |
| 行2 | ... | ... |
|     | ... | ... |
| --- | --- | --- |
|     | ... | ... |
| 行3 | ... | ... |
|     | ... | ... |
```

以下のように行2が非表示になる。そして、その上の行1と下の行3の間に「▲」「▼」のボタンが表示される。

```
      | 列A | 列B |
| --- | --- | --- |
|     | ... | ... |
| 行1 | ... | ... |
|  ▲  | ... | ... |
| --- | --- | --- |
|  ▼  | ... | ... |
| 行3 | ... | ... |
|     | ... | ... |
| --- | --- | --- |
```

この「▲」「▼」のボタンをクリックすることで、非表示にした行2を再度表示することができる。


### AssetInstance編集画面

cell-manage の `[%]` をクリックすると、そのAssetInstanceの個別設定を行うためのモーダルウィンドウが表示される。このウィンドウでは、元となるAssetのデフォルト値やAssetAttr参照を個別にオーバーライドすることができる。

#### ImageAssetInstance編集画面

```
      ┌───────────────────────────────────────────────────────────┐
      │ Background - Page 1                                       │
      ├───────────────────────────────────────────────────────────┤
      │                                                           │
      │                                                           │
      │                                                           │
      │                                                           │
      │                                                           │
      │   ┌─────────────────────┐       Original Width/Height     │
      │   │    Image Preview    │           ┌───────┐┌───────┐    │
      │   │                     │           │  100  ││   200 │    │
      │   │   o------------o    │           └───────┘└───────┘    │
      │   │   |            |    │       Default Width/Height      │
      │   │   |            |    │     [ ] 縦横比を元画像にあわせる│
      │   │   o------------o    │           ┌───────┐┌───────┐    │
      │   │                     │           │       ││       │    │
      │   │                     │           └───────┘└───────┘    │
      │   │                     │         Default PosX/PosY       │
      │   └─────────────────────┘           ┌───────┐┌───────┐    │
      │                                     │       ││       │    │
      │                                     └───────┘└───────┘    │
      │                                   Default Opacity         │
      │                                     o─[]────────────o     │
      │                                   Edit Mask [🖊️]          │
      └───────────────────────────────────────────────────────────┘
```

ペンのマークをクリックすると、下のマスク編集画面が開く。

マスク編集:
```
      ┌───────────────────────────────────────────────────────────┐
      │ Background - Page 1                                       │
      ├───────────────────────────────────────────────────────────┤
      │                                 Default Mask              │
      │    ┌─────────────────────┐      ┌───────┐      ┌───────┐  │
      │    │    Image Preview    │  P1:x│       │ P1:y │       │  │
      │    │                     │      └───────┘      └───────┘  │
      │    │   0------------0    │      ┌───────┐      ┌───────┐  │
      │    │   |            |    │  P2:x│       │ P2:y │       │  │
      │    │   |            |    │      └───────┘      └───────┘  │
      │    │   0------------0    │      ┌───────┐      ┌───────┐  │
      │    │                     │  P3:x│       │ P3:y │       │  │
      │    │                     │      └───────┘      └───────┘  │
      │    │                     │      ┌───────┐      ┌───────┐  │
      │    └─────────────────────┘  P4:x│       │ P4:y │       │  │
      │                                 └───────┘      └───────┘  │
      │                                                           │
      │                                Exit Mask Editor [<-]      │
      │                                                           │
      └───────────────────────────────────────────────────────────┘
```

基本的には ImageAsset の編集画面と同様の内容。


#### TextAsset 編集画面


左側の text-preview には SVG で描画されたテキストが表示される。
SVG の描画方法については、svg-structure.md を参照。
text-input には、直接テキストボックスがあり、複数行の入力が可能になっている。

Font はプルダウンボックスになっており、フォントが選択できる。
`▼` はドロップダウンメニューを開くためのアイコンである。実際は三角形の頂点が下を向いているアイコンが表示される。

Font Size、Stroke Width、PosX、PosY、Leading、Rotate、Z-Index はそれぞれの設定値を入力するための項目である。
マイナス値は許容されず、正の整数値のみが許容される。
Opacity はスライダーで調整することができ、0から100までの値を設定することができる。
Vertical Writing はチェックボックスで、チェックを入れると縦書きのテキストが表示される。

Color Stroke、Color はそれぞれの色を選択するための項目で、カラーピッカーが表示される。
`[🎨]` はカラーピッカーを開くためのアイコンである。

`[Save]` ボタンは、設定を保存するためのボタンである。

Asset Library では、テキスト自体は保持できず、あくまでフォントサイズや色、位置などの設定を保持する。
ただし、Sample Text にテキストを記入して、どのような見た目になるかどうかを動作確認できる。
プルダウンボックスで言語を選択することで、異なる言語のテキストの設定ができる。
デフォルトでは Project Header で設定された言語が選択されている。
内部的には default_language_settings に対応する値が表示される(data-types.md を参照)。

```
    ┌────────────────────────────────────────────────────────────────┐
    │ Character's talk                                           [x] │
    ├────────────────────────────────────────────────────────────────┤
    │                                |                               │
    │  text-preview                  |   Sample Text                 │
    │ ┌─────────────────────────┐    |   ┌─────────────────────────┐ │
    │ │                    H    │    |   │ HELLO                   │ │
    │ │                W   E    │    |   │ WORLD                   │ │
    │ │                O   L    │    |   │                         │ │
    │ │                R   L    │    |   │                         │ │
    │ │                L   O    │    |   │                         │ │
    │ │                D        │    |   │                         │ │
    │ │                         │    |   │                         │ │
    │ └─────────────────────────┘    |   └─────────────────────────┘ │
    │                                |    ┌────────────────┬───┐     │
    │                                | +- │  EN (English)  │ ▼ │---+ │
    │                                | |  └────────────────┴───┘   | │
    │                                | |         ┌───────────┬───┐ | │
    │                                | |   Font: │  Default  │ ▼ │ | │
    │                                | |         └───────────┴───┘ | │
    │                                | |                ┌─────┐    | │
    │                                | |     Font Size :│     │    | │
    │                                | |                └─────┘    | │
    │                                | |                ┌─────┐    | │
    │                                | |  Stroke Width :│     │    | │
    │                                | |                └─────┘    | │
    │                                | |     PosX  : PosY          | │
    │                                | |    ┌─────┐ ┌─────┐        | │
    │                                | |    └─────┘ └─────┘        | │
    │                                | |            ┌────┐         | │
    │                                | |   Leading: │ 0  │         | │
    │                                | |            └────┘         | │
    │                                | |                           | │
    │                                | |   ☑ Vertical Writing      | │
    │                                | |                           | │
    │                                | +---------------------------+ │
    │                                |                               │
    │                                |   Conetxt (?):                │
    │                                |     ┌───────────────────┐     │
    │                                |     │                   │     │
    │                                |     │                   │     │
    │                                |     │                   │     │
    │                                |     └───────────────────┘     │
    │                                |             ┌────┐            │
    │                                |    Z-Index: │ 0  │            │
    │                                |             └────┘            │
    │                                |    Opacity:                   │
    │                                |      o─[]────────────o        │
    │                                |                               │
    │                                |    Stroke Color:              │
    │                                |      ┌───────────────┐        │
    │                                |      │ #FFFFFF       │ [🎨]   │
    │                                |      └───────────────┘        │
    │                                |    Fill Color:                │
    │                                |      ┌───────────────┐        │
    │                                |      │ #FFFFFF       │ [🎨]   │
    │                                |      └───────────────┘        │
    │                                |                               │
    │                                |            [Save]             │
    └────────────────────────────────────────────────────────────────┘
```

`Context (?)` は、このテキストがどのような文脈で使用されるかを示すための項目である。
例えば「キャラクターのセリフ」や「メニューのタイトル」など、テキストがどのような役割を果たすかを記述する。
この項目は、テキストの内容を理解するための補助情報として利用され、生成AIがより適切なテキストを生成するための参考になる。

`(?)` は、ヘルプアイコンであり、クリックするとこの項目の説明が表示される。実際には青色の円で囲まれた `?` のアイコンが表示される。この項目をクリックするとヘルプモーダルが表示され、`Context (?)` の項目の説明が表示される。



#### TextAssetInstance 編集画面

TextAsset から TextAssetInstance において override できる項目のみが表示される。
override できない項目については、灰色のテキストで表示され、編集できないが、表示はされる。
`(not-editable)` と書かれた項目は、編集できないことを示す。実際にはその文言は表示されない。
デフォルトでは、Header の `[JA|▼]` で選択した言語のテキストが表示される。

```
    ┌────────────────────────────────────────────────────────────────┐
    │ Character's talk - Page 1                                  [x] │
    ├────────────────────────────────────────────────────────────────┤
    │                                |    ┌────────────────┬───┐     │
    │  text-preview                  | +- │  EN (English)  │ ▼ │---+ │
    │ ┌─────────────────────────┐    | |  └────────────────┴───┘   | │
    │ │                    H    │    | |                           | │
    │ │                W   E    │    | |  Text                     | │
    │ │                O   L    │    | | ┌────────────────────────┐| │
    │ │                R   L    │    | | │ HELLO                  │| │
    │ │                L   O    │    | | │ WORLD                  │| │
    │ │                D        │    | | │                        │| │
    │ │                         │    | | │                        │| │
    │ └─────────────────────────┘    | | │                        │| │
    │                                | | │                        │| │
    │                                | | │                        │| │
    │                                | | └────────────────────────┘| │
    │                                | |                           | │
    │                                | |         ┌───────────┬───┐ | │
    │                                | |   Font: │  Default  │ ▼ │ | │
    │                                | |         └───────────┴───┘ | │
    │                                | |                ┌─────┐    | │
    │                                | |     Font Size :│     │    | │
    │                                | |                └─────┘    | │
    │                                | |                ┌─────┐    | │
    │                                | |  Stroke Width :│     │    | │
    │                                | |                └─────┘    | │
    │                                | |     PosX  : PosY          | │
    │                                | |    ┌─────┐ ┌─────┐        | │
    │                                | |    └─────┘ └─────┘        | │
    │                                | |            ┌────┐         | │
    │                                | |   Leading: │ 0  │         | │
    │                                | |            └────┘         | │
    │                                | |                           | │
    │                                | |   ☑ Vertical Writing      | │
    │                                | |                           | │
    │                                | +---------------------------+ │
    │                                |                               │
    │                                |   Conetxt :                   │
    │                                |     ┌───────────────────┐     │
    │                                |     │                   │     │
    │                                |     │                   │     │
    │                                |     │                   │     │
    │                                |     └───────────────────┘     │
    │                                |             ┌────┐            │
    │                                |    Z-Index: │ 0  │            │
    │                                |             └────┘            │
    │                                |    Opacity:                   │
    │                                |      o─[]────────────o        │
    │                                |                               │
    │                                | (not-editable)Stroke Color:   │
    │                                |      ┌───────────────┐        │
    │                                |      │ #FFFFFF       │ [🎨]   │
    │                                |      └───────────────┘        │
    │                                | (not-editable)Fill Color:     │
    │                                |      ┌───────────────┐        │
    │                                |      │ #FFFFFF       │ [🎨]   │
    │                                |      └───────────────┘        │
    │                                |                               │
    │                                |            [Save]             │
    └────────────────────────────────────────────────────────────────┘
```



#### ValueAsset 編集画面

ValueAsset は Asset Library で追加ボタンを押下したあと、自動的にモーダルが表示される。
全ての項目を埋めなければ Save はできない。

```
    ┌──────────────────────────────────────────────┐
    │ ValueAsset Creation                     [x]  │
    ├──────────────────────────────────────────────┤
    │                                              │
    │  ID [?]                                      │
    │  ┌──────────────────────────────────┐        │
    │  │                                  │        │
    │  └──────────────────────────────────┘        │
    │                                              │
    │  Value Type                                  │
    │    (o) String                                │
    │    ( ) Number                                │
    │    ( ) Formula                               │
    │                                              │
    │  Initial Value                               │
    │  ┌──────────────────────────────────┐        │
    │  │                                  │        │
    │  └──────────────────────────────────┘        │
    │  Value for new page [?]                      │
    │  (o) Reset to initial value                  │
    │  ( ) Inherit previous page's value           │
    │                                              │
    │                                              │
    │             [Cancel]    [Save]               │
    └──────────────────────────────────────────────┘
```

ID は、ValueAsset の識別子であり、他の Asset と重複しないように設定する必要がある。
また、ID は英数字とアンダースコア（_）のみを使用することができる。数字で開始することはできない。IDの横の`[?]`をクリックすると、ヘルプモーダルID の命名規則についてのヘルプが表示される。

Initial Value は、ValueAsset の初期値であり、任意の値を設定することができる。1ページ目はこの値となるが、ValueAssetInstance側で上書きは可能。任意の文字列を記入できるが、Value Type で String を選択した場合は文字列、Number を選択した場合は数値、Formula を選択した場合は数式を入力する必要がある。もし不正な文字列を記入するとエラーメッセージが表示され、Save ボタンは押せなくなる。

Value for new page は、新しいページに対して ValueAsset の値をどのように設定するかを選択することができる。Reset to initial value を選択すると、新しいページに対して初期値が設定される。一方で、Inherit previous page's value を選択すると、前のページの値が引き継がれる。


#### ValueAssetEdit 編集画面

ValueAssetEdit の編集画面は SpreadSheet Window のセルの ValueAsset に該当するセルの編集ボタンを押下することで表示される。Override Value のみを編集することができる。
`non-editable` で開始する項目は編集ができず、テキストボックスは灰色であり、ラジオボタンも灰色で選択できない。実際には `non-editable:` という文言は存在しない。

`Current Result (For formula)` は Value Type が Formula の場合に表示される項目で、現在の数式の結果を表示する。数式を入力すると、その結果がここに表示される。

```
    ┌──────────────────────────────────────────────┐
    │ ValueAsset Creation                     [x]  │
    ├──────────────────────────────────────────────┤
    │                                              │
    │  non-editable: ID [?]                        │
    │  ┌──────────────────────────────────┐        │
    │  │ value_asset_id                   │        │
    │  └──────────────────────────────────┘        │
    │  non-editable: Initial Value                 │
    │  ┌──────────────────────────────────┐        │
    │  │ 0                                │        │
    │  └──────────────────────────────────┘        │
    │  non-editable: Value for new page [?]        │
    │  (o) Reset to initial value                  │
    │  ( ) Inherit previous page's value           │
    │                                              │
    │  non-editable: Value Type                    │
    │    (o) String                                │
    │    ( ) Number                                │
    │    ( ) Formula                               │
    │                                              │
    │  Override Value                              │
    │  ┌──────────────────────────────────┐        │
    │  │                                  │        │
    │  └──────────────────────────────────┘        │
    │  Current Result (For formula) :[       ]     │
    │                                              │
    │             [Cancel]    [Save]               │
    └──────────────────────────────────────────────┘
```


#### DynamicVectorAsset 編集画面

Script の箇所に JavaScript スクリプトを記載でき、返り値の文字列を SVG として解釈して描画するアセット。Script の箇所には JavaScript のソースコードが記載される。そして、ソースコードの実行結果の返り値の結果を SVG として解釈して描画を行う。

想定動作については asset-specification.md も参照のこと。


```
    ┌─────────────────────────────────────────────────────────────┐
    │ DynamicVectorAsset                                     [x]  │
    ├─────────────────────────────────────────────────────────────┤
    │                              |                              │
    │  Preview                     |  Name                        │
    │ ┌─────────────────────────┐  | ┌─────────────────────────┐  │
    │ │ +-----------+           │  | │                         │  │
    │ │ |           |           │  | └─────────────────────────┘  │
    │ │ +-----------+           │  |         ┌─────┐              │
    │ │                         │  |  var_1  │10   │              │
    │ │                         │  |         └─────┘              │
    │ │                         │  |         ┌─────┐              │
    │ │                         │  |  var_2  │abc  │              │
    │ │                         │  |         └─────┘              │
    │ │                         │  |       ...                    │
    │ └─────────────────────────┘  |        PosX    PosY          │
    │                              |        ┌─────┐ ┌─────┐       │
    │                              |        │     │ │     │       │
    │                              |        └─────┘ └─────┘       │
    │                              |        Width    Height       │
    │                              |        ┌─────┐ ┌─────┐       │
    │                              |        │     │ │     │       │
    │                              |        └─────┘ └─────┘       │
    │                              |  Opacity:                    │
    │                              |    o─[]────────────o         │
    │                              |           ┌────┐             │
    │                              |  Z-Index: │ 0  │             │
    │                              |           └────┘             │
    │                              |                              │
    └─────────────────────────────────────────────────────────────┘
```

CustomAsset として読み込める DynamicVectorAsset は、@parameters によって指定される変数を編集することができる。`var_1`, `var_2`, ... が例示として挙げられている（実際には var_1, var_2 という名前ではなく、@parameters に指定されている経数名が表示される）。
これは、@parameters で指定された変数名が表示される。
(dynamic-vector-asset.md を参照）

右側のパネルのパラメータを編集して、マウスのフォーカスを外すと、JavaScript が実行され、プレビューが更新される。

VectorAssetの編集時のロジックと全く同様で、JavaScriptで生成された SVG を、さらに新たな `<svg>`要素で囲むことで、X,Y 座標や Width, Height を指定できるようにしている（詳しくはsvg-structure.mdを参照）。

## Preview Window

  - Page の内容を確認するためのウィンドウ。Page がどのように見えるかを確認することができる。
  - Preview Window は、複数ページを横断的に確認できる。
  - ⌘ + マウスホイールで page の大きさが変更できる。
  - パネルの表示/非表示切り替えボタンを備えている
  - キャンバスサイズに合わせた実際のサイズ表示とスクロール機能を提供

### Preview Controls

プレビューウィンドウのヘッダーには以下のコントロールが配置されている：

- **ズームスライダー**：0.1倍から3.0倍まで段階的にズーム調整可能
- **フィットボタン**：キャンバス全体をプレビュー画面に収める（自動ズーム・中央配置）
  - ズームスライダーの横にはフィットボタンがある。
  - 図には `[-@-]` というアイコンがあるが、実際は四角形が二重になり、内側の四角形の四方向から線が外側の四角形に内接しているデザインをしている。
  - フィットボタンをトグルスイッチにして、トグルが ON の間は Preview Window のサイズにあわせて自動的にキャンバスがズームするようになる。起動時にフィットボタンは ON の状態。
  - ズームスライダーを動かすと、フィットボタンは自動的に OFF になる。
- **ページ情報**：現在のページ番号、アセット数、キャンバスサイズを表示

### Navigation Features

- **スクロール操作**：キャンバスが大きい場合は自動的にスクロールバーが表示
- **パン操作**：マウス中ボタン（ホイールボタン）を押しながらドラッグで自由移動
- **ズーム操作**：⌘キー + マウスホイールで拡大・縮小

```
   ┌─────────────────────────────────────────────────────────────┐
   │  Preview                                                    │
   │  倍率:  o─[]────────────o 100%  [-@-]                       │
   │                              Page N: Assets:N  NNNxNNN px   │
   ├─────────────────────────────────────────────────────────────┤
   │                                                          ┌─┐│
   │                                                          │ ││
   │                                                          │ ││
   │                                                          │ ││
   │            ┌─────────────────────┐                       │ ││
   │            │                     │                       │ ││
   │            │                     │                       │ ││
   │            │                     │                       │ ││
   │            │                     │                       │ ││
   │            │                     │                       │ ││
   │            │   page content      │                       │ ││
   │            │                     │                       │ ││
   │            │                     │                       │ ││
   │            │                     │                       │ ││
   │            └─────────────────────┘                       │ ││
   │                                                          │ ││
   │                                                          │ ┼┼─────┐
   │                                                          │ ││     │
   │                                                          │ ││   scroll bar
   │                                                          │ ││
   │                                                          └─┘│
   └─────────────────────────────────────────────────────────────┘
```

#### VectorAsset 編集画面

TBD

#### DynamicVector 編集画面

## Font management

TextAsset/TextAssetInstance で利用されるフォントには 2 種類が存在する

- アプリケーションのビルトインで存在するフォント
- ユーザが追加したカスタムフォント

Menu Bar から Custom Fonts を選択すると、カスタムフォントの管理画面が表示される。
画面や以下のようなレイアウトになっている。
Sample Text はテキストボックスとなっており、ユーザが任意の文章を入力できる。
その下に、フォントの文字列を表示するための領域があり、そこに Sample Text の内容が表示される。
以下の例の「Rounded-X M+ 1p」や「Mansalva」は、ソフトウェアのビルトインのフォントの例である。

```
   ┌────────────────────────────────────────────────────────────────────────┐ 
   │                                                                     [x]│ 
   │                                                                        │ 
   │   Sample Text                                                          │ 
   │  ┌───────────────────────────────────────────────────────────┐         │ 
   │  │ HELLO WORLD                                               │         │ 
   │  └───────────────────────────────────────────────────────────┘         │ 
   │  ┌─────────────────────────────────────────────────────────────────┐   │ 
   │  │                                                                 │   │ 
   │  │  ┌───────────────────────────────────────────────────────────┐  │   │ 
   │  │  │ Rounded-X M+ 1p                                  [LICENSE]│  │   │ 
   │  │  │ HELLO WORLD                                               │  │   │ 
   │  │  │                                                           │  │   │ 
   │  │  └───────────────────────────────────────────────────────────┘  │   │ 
   │  │  ┌───────────────────────────────────────────────────────────┐  │   │ 
   │  │  │ Mansalva                                         [LICENSE]│  │   │ 
   │  │  │ HELLO WORLD                                               │  │   │ 
   │  │  │                                                           │  │   │ 
   │  │  └───────────────────────────────────────────────────────────┘  │   │ 
   │  │  ┌───────────────────────────────────────────────────────────┐  │   │ 
   │  │  │ WDXL Lubrifont TC   (Google Fonts)               [LICENSE]│  │   │ 
   │  │  │ HELLO WORLD                                               │  │   │ 
   │  │  │                                                           │  │   │ 
   │  │  └───────────────────────────────────────────────────────────┘  │   │ 
   │  │   ...                                                           │   │ 
   │  └─────────────────────────────────────────────────────────────────┘   │ 
   │                         ┌──────────────────┐  ┌─────────────────┐      │ 
   │                         │  Delete Font     │  │  Add Font       │      │ 
   │                         └──────────────────┘  └─────────────────┘      │ 
   └────────────────────────────────────────────────────────────────────────┘ 
```

ビルトインフォントの管理方法については ./docs/fonts.md を参照。

フォントの矩形をユーザはクリックすることができ、その状態で「Delete Font」ボタンをクリックすると、そのフォントが削除される。
ただし、ビルトインのフォントは削除できない。
また、「Add Font」ボタンをクリックすると、以下の画面が開く。

```
  ┌────────────────────────────────────────────────────────────┐
  │  (o) Embed   ( ) Google Fonts  ( ) Builtin                 │
  │  ┌──────────────────────────────────────────────────────┐  │
  │  │    Font File                                         │  │
  │  │           ┌────────────────────────────────────┐     │  │
  │  │           │                                    │ [📁]│  │
  │  │           └────────────────────────────────────┘     │  │
  │  │    License File [?]                                  │  │
  │  │           ┌────────────────────────────────────┐     │  │
  │  │           │                                    │ [📁]│  │
  │  │           └────────────────────────────────────┘     │  │
  │  │                                                      │  │
  │  └──────────────────────────────────────────────────────┘  │
  │                                                            │
  │      ┌───────────┐ ┌───────────┐                           │
  │      │   Add     │ │  Cancel   │                           │
  │      └───────────┘ └───────────┘                           │
  └────────────────────────────────────────────────────────────┘
```

Font File を選択すると、ユーザがローカルのフォントファイル（ttf, otf など）を選択するダイアログが開き、選択したフォントが追加される。
License File は、フォントのライセンス情報を記載したテキストファイルを選択するためのものである。
この Lisense File は、フォントファイルと同じ名前でなければならない。

`[?]` はUI上は丸で囲んだ`?`であり、クリックすると、フォントのライセンス情報の利用用途は、利用時の注意が表示される。以下のような説明。
  - フォントは HTML ファイルでのエクスポート時にファイルに埋め込まれる
  - HTML ファイルのビューワーに、著作権表示がされるページも追加される
  - フォントを利用する際には、ライセンス情報を確認することが推奨される
  - 特に、商用利用が可能かどうか、組み込み利用が可能かどうか、再配布が可能かどうかを確認することをよく確認すること

ここに追加したフォントが、TextAsset/TextAssetInstance のフォント選択のドロップダウンメニューに表示される。
また、ここに追加したフォントかつ、プロジェクト内で TextAsset/TextAssetInstance で利用されているフォントは、プロジェクトの保存時に font ディレクトリ内に一緒に保存される。
加えて、HTML ファイルでのエクスポート時には、 CSS の箇所に　Base64 としてフォントが埋め込まれる（html-export.md参照）。

ビルトインのフォントの管理方法については、./docs/fonts.md を参照。

さらに上記の画面は `(o) Embed   ( ) Google Fonts` というアイコンがあるが、これはフォントファイルをローカルのファイルシステムから選択するか、あるいは URL を指定して組み込むかを選択するためのものである。

ラジオボタンをクリックすることで、どちらかを選択できる。
もしも `Google Fonts` を選択した場合、フォントファイルの URL を入力するためのテキストボックスが表示される。
以下のような画面になる。

```
  ┌──────────────────────────────────────────────────────────────────────────┐
  │  ( ) Embed   (o) Google Fonts                                            │
  │  ┌────────────────────────────────────────────────────────────────────┐  │
  │  │   Google Font URL [?]                                              │  │
  │  │           ┌──────────────────────────────────────────────────┐     │  │
  │  │           │ https://fonts.googleapis.com/css2?family=My+Font │     │  │
  │  │           └──────────────────────────────────────────────────┘     │  │
  │  └────────────────────────────────────────────────────────────────────┘  │
  │                                                                          │
  │      ┌───────────┐ ┌──────────┐                                          │
  │      │   Add     │ │  Cancel  │                                          │
  │      └───────────┘ └──────────┘                                          │
  └──────────────────────────────────────────────────────────────────────────┘
```

`Google Fonts URL` の部分は、HTML ファイルの `<head>` セクションに追加するためのGoogle Font のURLを入力するためのテキストボックスである。
デフォルトでは、Google Fonts のフォントを利用するためのURLがサンプルとして薄い灰色（input タグの placeholder のようなデザイン）で表示されている。
`[?]` の箇所（実際は円で`?`を囲んだ青いアイコン）クリックすると、Google Fonts の利用方法についての説明が表示される。
以下のような説明が表示される。

"""
フォントのファイルを指定せず、[Google Fonts](https://fonts.google.com/) の提供するフォントを利用できます。HTML ファイルでのエクスポート時には、Google Fonts のフォントを利用するための CSS の記述が自動的に追加されます。
**フォントの配布元がフォントの提供を停止した場合、フォントが表示されなくなる可能性がある点は注意してください。**

Google Fonts を利用する場合は、Goole Fonts の「Web」の `<link>` の箇所を開き、以下のような記述から URL の箇所をコピーして、上記のテキストボックスに貼り付けてください。
以下の記述の場合、`https://fonts.googleapis.com/css?family=Example+Font` の部分をコピーしてください。

```html
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css?family=Example+Font" rel="stylesheet">
```
"""

説明文の箇所をクリックすると、Alert ダイアログではなく、現在表示中のモーダルの表示が切り替わる。
以下のような形。
Close をクリックすると前の画面に戻る。

```
  ┌──────────────────────────────────────────────────────────────────────────┐
  │  ┌────────────────────────────────────────────────────────────────────┐  │
  │  │                                                                    │  │
  │  │                                                                    │  │
  │  │                                                                    │  │
  │  │   説明文                                                           │  │
  │  │                                                                    │  │
  │  │                                                                    │  │
  │  │                                                                    │  │
  │  └────────────────────────────────────────────────────────────────────┘  │
  │                           ┌───────────┐                                  │
  │                           │   Close   │                                  │
  │                           └───────────┘                                  │
  └──────────────────────────────────────────────────────────────────────────┘
```

## Builtin font management

環境変数 `KOMAE_ADMIN` が設定されている場合、Font Management 画面のラジオボタンは以下の 3 つになる。

```
  │  (o) Embed   ( ) Google Fonts  ( ) Builtin                 │
```

`( ) Builtin` は、アプリケーションにビルトインされているフォントを選択するためのもの。
動作は `( ) Embed` と同様だが、public/fonts 配下にフォントとレジストリ用の json ファイルが保存される。


## License information modal

Font management モーダルの `[LICENSE]` をクリックすると、フォントのライセンス情報を表示する。

```
   ┌────────────────────────────────────────────────────────────────────────┐
   │ License Information                                                 [x]│
   ├────────────────────────────────────────────────────────────────────────┤
   │                                                                        │
   │  Noto Sans JP                                                          │
   │  Google Fonts                                                          │
   │  URL: https://fonts.googleapis.com/css2?family=Noto+Sans+JP...         │
   │                                                                        │
   │  ┌──────────────────────────────────────────────────────────────────┐  │
   │  │ This is a Google Fonts font. Google Fonts are generally          │  │
   │  │ licensed under open source licenses (such as OFL, Apache, etc.)  │  │
   │  │                                                                  │  │
   │  │ For detailed license information, please visit:                  │  │
   │  │                                                                  │  │
   │  │ • Noto Sans JP License Page                                      │  │
   │  │ • Google Fonts General Information                               │  │
   │  └──────────────────────────────────────────────────────────────────┘  │
   │                                                                        │
   │                                ┌───────────┐                           │
   │                                │   Close   │                           │
   │                                └───────────┘                           │
   └────────────────────────────────────────────────────────────────────────┘
```

**フォントタイプ別の表示内容:**

### ビルトインフォント/カスタムフォント（埋め込み）
- フォント名とファイル名を表示
- ライセンステキストが登録されている場合はそのまま表示
- ライセンス情報がない場合は適切な案内メッセージを表示

### Google Fonts
- フォント名とGoogle Fonts URLを表示（クリックで外部ブラウザが開く）
- Google Fontsの一般的なライセンス説明
- 以下のリンクを提供（すべて外部ブラウザで開く）:
  - `{フォント名} License Page`: `https://fonts.google.com/specimen/{URLエンコードしたフォント名}/license`
  - `Google Fonts General Information`: `https://fonts.google.com/`

**技術実装:**
- リンククリック時は`window.electronAPI.system.openExternal()`で外部ブラウザを起動
- Google FontsのURL表示では適切なURLエンコーディングを実行
- フォントタイプに応じた条件分岐による表示制御


## TextAsset Bulk Edit Screen

Project Header にある `TextAsset Bulk Edit` ボタンをクリックすると、TextAsset の一括編集画面が表示される。
これは、現在のプロジェクト内に存在する TextAssetInstance の一覧を表示し、各 TextAssetInstance のテキストをページごとに一括でyaml 形式でエクスポート/インポートする機能である。

この機能の狙いとして、複数言語のテキストの一括の編集は、スプレッドシートの UI ではかなり厳しい。
そこで、TextAsset の一括編集画面を用意し、ここで YAML 形式での一括編集を行うことができるようにする。
特に、この機能で出力されたテキストを、直接テキストエディタで編集したり、あるいは生成 AI を使って一括で編集させることができるような用途を想定している。

ボタンをクリックすると、以下のような画面が表示される。

```
  ┌───────────────────────────────────────────────────────────┐ 
  │                                   ┌────────────────────┐  │ 
  │   What is this [?]                │  Copy AI Prompt ✨ │  │ 
  │                                   └────────────────────┘  │ 
  │  ┌─────────────────────────────────────────────────────┐  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │    yaml                                             │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  └─────────────────────────────────────────────────────┘  │ 
  │                              ┌───────────┐ ┌───────────┐  │ 
  │                              │   Import  │ │  Cancel   │  │ 
  │                              └───────────┘ └───────────┘  │ 
  └───────────────────────────────────────────────────────────┘ 
```

上記の yaml の部分は編集可能なテキストボックス担っている。
デフォルトでは、以下のような形式でプロジェクト内部の TextAssetInstance の内容だけが表示される。

```
pages:
- id: page-xxxxx
  instance-xxxx:
    name: Character1
    ja: |
      こんにちは
    en: |
      Hello
    zh: |
      你好
  instance-yyyy:
    name: Character2
    ja: |
      お元気ですか？
    en: |
      How are you?
    zh: |
      你好吗？
- id: page-xxxxx
  // ...
```

テキストボックス内部に編集が行われた場合、`Import` ボタンが有効化される。
Import ボタンをクリックすると、テキストボックス内の内容がプロジェクト内の TextAssetInstance に反映される。

「Copy AI Prompt」ボタンをクリックすると、AI による一括編集のためのプロンプトがクリップボードにコピーされる。

```
以下の YAML テキストを編集してください。この YAML テキストは、ビジュアルノベルプロジェクトのセリフの設定ファイルとして使われます。有効なYAMLフォーマットを保つように「TODO」の箇所を、その言語コードの表す言語の文章に変更してください。YAMLの「languages」の箇所に、文字コードがどの国の言語を表すかを記載しています。また、「pages」の配列要素のそれぞれがページをあらわし、先頭にある要素ほど前半のページです。各ページの`instance-`で開始するキーは、一つの文章のまとまりです。`name`要素には、そのまとまりの参考となる文脈が含まれている場合があります。`instance-`直下には国コードのキーが存在し、翻訳文が含まれます。すでに存在する翻訳文を参考にしてTODOの箇所を翻訳してください。翻訳が正確で、そのページ自体の文脈だけでなく、前後の文脈を踏まえて適切な翻訳であることを確認してください。文章のブロックは横幅の調整のために改行を含んでいる場合があります。翻訳文も同じような文章幅を保つように適宜改行をいれてください。


\`\`\`yaml
languages:
- ja:Japanese
- en:English
- zh:Chinese
- kr:Korean
- it:Italian
  
pages:
- id: page-xxxxx
  instance-xxxx:
    name: Character1
    ja: |
      こんにちは
    en: |
      Hello
    zh: |
      你好
    kr: TODO
    it: TODO
  instance-yyyy:
    name: Character2
    ja: |
      お元気ですか？
    en: |
      How are you?
    zh: |
      你好吗？
    kr: TODO
    it: TODO
\`\`\`
```

## Implementation Details

### Technical Architecture
- **状態管理**：Zustand store (`projectStore.ts`) で `showAssetLibrary` と `showPreview` を管理
- **レイアウト**：CSS Grid を使用し、パネル表示状態に応じて動的にカラムを調整
- **アイコン**：SVGコンポーネントとして実装し、React内で再利用可能

### Key Files
- `MainLayout.tsx`：メインレイアウトとパネル切り替えロジック
- `AssetLibrary.tsx`：アセットライブラリコンポーネント（閉じるボタン・スクロール機能含む）
- `PreviewArea.tsx`：プレビューエリアコンポーネント（閉じるボタン・フィット機能・パン操作含む）
- `EnhancedSpreadsheet.tsx`：ページ管理機能が統合されたスプレッドシート（スクロール・パン機能含む）
- `PanelIcons.tsx`：SVGアイコンコンポーネント（FitToViewIcon含む）
- `MainLayout.css`：動的レイアウトスタイル
- `App.css`：共通スクロールバースタイル（.scrollbar-largeクラス）

### macOS Compatibility
- **タイトルバースタイル**：`default` を使用してウィンドウ操作の互換性を確保
- **コンテンツマージン**：システムタイトルバーとの重複を回避するよう調整

### Layout States
1. **フル表示**：全パネル表示 (`grid-template-columns: 280px 1fr 320px`)
2. **Asset非表示**：中央＋Preview (`grid-template-columns: 1fr 320px`)
3. **Preview非表示**：Asset＋中央 (`grid-template-columns: 280px 1fr`)
4. **フルスクリーン**：中央のみ (`grid-template-columns: 1fr`)

### Scrolling & Navigation
- **統一スクロールバー**：`.scrollbar-large`クラスによる一貫したスクロールバースタイル
- **動的表示**：コンテンツが領域を超える場合のみスクロールバーを表示（`overflow-y: auto`）
- **レスポンシブ幅制御**：スプレッドシートは画面幅に応じて動的に最大幅を調整
- **パン操作**：マウス中ボタンによる直感的なナビゲーション（スプレッドシート・プレビュー両対応）
