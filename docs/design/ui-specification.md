# User Interface

##  Overview

本ソフトウェアは3つのパネルで構成されている。
- Asset Library（左パネル）
- Spread Sheet（中央パネル）
- Preview Window（右パネル）

各パネルは表示/非表示を切り替えることができ、動的なレイアウト調整により効率的な作業スペースを提供する。

### 基本レイアウト（全パネル表示）
```
   ┌─────────────────┬──────────────────────────────┬─────────────────┐
   │ [◄] Asset      │        Project Name          │    Preview [►]  │
   │                 ├──────────────────────────────┤                 │
   │                 │                              │                 │
   │  Asset Library  │       Spread Sheet           │  Preview Window │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   └─────────────────┴──────────────────────────────┴─────────────────┘
```

### 片方非表示レイアウト
```
   ┌─────────────────────────────────────────────┬─────────────────┐
   │ [◄]             Project Name                │    Preview [►]  │
   │                                             ├─────────────────┤
   │                                             │                 │
   │            Spread Sheet                     │  Preview Window │
   │                                             │                 │
   │                                             │                 │
   └─────────────────────────────────────────────┴─────────────────┘
```

### フルスクリーンレイアウト（両パネル非表示）
```
   ┌─────────────────────────────────────────────────────────────┐
   │ [◄]             Project Name                         [►]    │
   ├─────────────────────────────────────────────────────────────┤
   │                                                             │
   │                     Spread Sheet                           │
   │                                                             │
   │                                                             │
   └─────────────────────────────────────────────────────────────┘
```

Created by [Ascii Flow](https://asciiflow.com/#/)

さらに、OS 提供のメニューバーが存在し、そこから新規プロジェクトの作成や、プロジェクトの保存、エクスポートなどを行うことができる。

- File
  - New Project
  - Open Project
  - Save Project
  - Export Project
    - Export to PNG
    - Export to HTML
- Edit
  - Undo
  - Redo
  - Cut
  - Copy
  - Paste
- Help
  - About
  - Documentation
  - Check for Updates

## Panel Toggle System

### Dynamic Button Positioning

各パネルの表示切り替えボタンは、表示状態に応じて動的に位置を変更する：

#### Asset Library Toggle
- **閉じるボタン**：アセットライブラリ内のヘッダー左側
- **開くボタン**：中央パネルのツールバー左側（プロジェクト名の左）

#### Preview Window Toggle  
- **閉じるボタン**：プレビューウィンドウ内のヘッダー右側
- **開くボタン**：中央パネルのツールバー右側（プロジェクト名の右）

### SVG Icons

パネル切り替えボタンには、以下のSVGアイコンを使用：
- `PanelCollapseLeftIcon`：アセットライブラリ閉じるボタン
- `PanelExpandLeftIcon`：アセットライブラリ開くボタン  
- `PanelCollapseRightIcon`：プレビューウィンドウ閉じるボタン
- `PanelExpandRightIcon`：プレビューウィンドウ開くボタン
- `FitToViewIcon`：プレビューウィンドウのフィット表示ボタン

アイコンは`currentColor`を使用してテーマ一貫性を保ち、ホバー効果にも対応している。

## Asset Window

  - Asset（テンプレート）を管理する場所。entity.md参照。
  - 画像ファイルをドラッグアンドドロップしたり、メニューバーから新規作成したりすることで Asset を追加することができる。
  - Asset のアイコンは以下の様になる
    - ImageAsset ... 登録されている画像を縮小したもの
    - TextAsset ... 「T」の文字が書かれたアイコン
  - パネルの表示/非表示切り替えボタンを備えている
  - **縦スクロール機能**：多数のアセットがある場合は自動的に縦スクロールバーが表示される

```
    ┌───────────────────────────────────────────────────────┐
    │                                                       │
    │   ┌───────────┐    ┌───────────┐    ┌───────────┐     │
    │   │           │    │           │    │           │     │
    │   │           │    │           │    │           │     │
    │   │ Asset1    │    │ Asset2    │    │  Asset3   │     │
    │   │           │    │           │    │           │     │
    │   │           │    │           │    │           │     │
    │   │           │    │           │    │           │     │
    │   └───────────┘    └───────────┘    └───────────┘     │
    │                                                       │
    │                                                       │
    │   ┌───────────┐   ┌───────────┐     ┌───────────┐     │
    │   │           │   │           │     │           │     │
    │   │           │   │           │     │           │     │
    │   │ Asset4    │   │ Asset5    │     │  Asset6   │     │
    │   │           │   │           │     │           │     │
    │   │           │   │           │     │           │     │
    │   │           │   │           │     │           │     │
    │   └───────────┘   └───────────┘     └───────────┘     │
    │                                                       │
    │                                                       │
    └───────────────────────────────────────────────────────┘
```

### Asset Management

それぞれのアセットは、種類ごとに異なる特性を持つ。
Asset Window 上でダブルクリックすることで、画面全体がアセットの編集ウィンドウに切り替わる。

#### ImageAsset

最も本ソフトウェアで利用されるであろうアセット
Asset Window で画像ファイルをドラッグアンドドロップすることで作成される。
さらに Asset Window 上でダブルクリック、あるいは右クリックからメニューを出して「Edit」を選ぶと、詳細を編集するウィンドウが開く。以下のような感じ。

```
      ┌─────────────────────────────────────────────────────────────┐
      │                  800x600          Default Width/Height      │
      │    ┌─────────────────────┐            ┌───────┐┌───────┐    │
      │    │                     │            │       ││       │ [v]│ --- SizeAssetAttr参照     
      │    │                     │            └───────┘└───────┘    │
      │    │                     │          Default PosX/PosY       │
      │    │    Image Preview    │            ┌───────┐┌───────┐    │
      │    │                     │            │       ││       │ [v]│ --- PositionAssetAttr参照     
      │    │                     │            └───────┘└───────┘    │
      │    │                     │          Default Opacity         │      
      │    │                     │            o─[]────────────o     │
      │    └─────────────────────┘          Edit Mask [🖊️]          │      
      └─────────────────────────────────────────────────────────────┘      
```

ペンのマークをクリックすると、下のマスク編集画面が開く。

マスク編集:
```
      ┌───────────────────────────────────────────────────────────┐
      │                  800x600        Default Mask              │
      │    ┌─────────────────────┐      ┌───────┐      ┌───────┐  │
      │    │                     │  P1:x│       │ P1:y │       │  │
      │    │                     │      └───────┘      └───────┘  │
      │    │                     │      ┌───────┐      ┌───────┐  │
      │    │    Image Preview    │  P2:x│       │ P2:y │       │  │
      │    │                     │      └───────┘      └───────┘  │
      │    │                     │      ┌───────┐      ┌───────┐  │
      │    │                     │  P3:x│       │ P3:y │       │  │
      │    │                     │      └───────┘      └───────┘  │
      │    │                     │      ┌───────┐      ┌───────┐  │
      │    │                     │  P4:x│       │ P4:y │       │  │
      │    └─────────────────────┘      └───────┘      └───────┘  │
      └───────────────────────────────────────────────────────────┘
```

マスク編集画面では、マスク領域を矩形で指定できる。


Image Preview は、デフォルトのキャンバスサイズの枠の中に、
ImageAsset の画像を表示するための領域で、画像の大きさや位置を確認することができる。
マウス操作で画像の位置や大きさを変更することができる。
また、横には画像のデフォルト値を設定するためのテキストボックスがあり、実際に数値を入力することで、ImageAsset のデフォルト値を変更することができる。
また、上記の`[v]`の部分をクリックすることで、ドロップダウンメニューが表示され、既存の AssetAttr を選択することができる。新しい AssetAttr を作成したい場合は、ドロップダウンで「新規作成」を選択する。
AssetAttr を専用で編集する UI 画面はなく、この画面で値を変更することで AssetAttr の値も更新される。

## Spread Sheet Window

本ソフトウェアの特徴的な特性は、複数 Page での横断編集が極めて容易であること。
- UI 上の Spread Sheet には、Microsoft Excel のような格子状の表形式のエディタがあり、複数の Page にまたがる AssetInstance の情報を編集することができる。
- それぞれの行は Page を表し、列は Asset（テンプレート）を表す。
- ある Page で特定の AssetInstance を作成した場合、セルに元となった Asset の列が表示される。
- ページ管理機能が統合されており、従来の独立したPageListコンポーネントは不要になった。
- 例えば
  - Asset Window に画像ファイルをドロップして、「My Girl」という ImageAsset を作成
  - 「My Girl」をSpread Sheet にドロップする
  - すると、My Girl の列が Spread Sheet に追加される。
  - 各セルにはチェックボックスが表示され、チェックを入れることで AssetInstance を Page 上に配置することができる。
  - また、チェックボックス以外のセル内部の場所をクリックすることで、AssetInstance の個別設定（位置のオーバーライド、AssetAttr参照の変更、透明度調整など）を行うためのウィンドウがモーダルとして表示される
  - 列のタイトルをクリックすることで、Excel のように、列全体を選択することができる
  - 列のタイトルを右クリックすることで、非表示にすることができる。例えば背景画像など、常に表示して編集する必要がない場合は、非表示にしておくことができる。
  - 列をドラッグすることで、列の順番を変更することができる。
  - [+] ボタンをクリックすることで、新たにページを追加することができる。
  - Preview の列には各ページのプレビューが表示される。プレビューは、ページの内容を確認するためのもので、クリックすることで Preview Window でそのページが表示される。
  - `#` の列には、ページの番号が表示される。
  - ページの順番は、Spread Sheet 上でドラッグアンドドロップで変更することができる。
  - `#` の列の横にある `[-]` ボタンをクリックすることで、そのページを削除することができる。UI上はXボタンのように表示される。
  - **スクロール機能**：多数のページ・アセットがある場合は縦・横スクロールバーが表示される
  - **パン機能**：マウス中ボタン（ホイールボタン）を押しながらドラッグすることで自由自在にパン操作が可能

```
     #  Preview  My Girl         Background      Girls Speech    Effect
   ┌───┬──────┬───────────────┬───────────────┬───────────────┬───────────────┐
[-]│ 1 │      │ [x]           │ [x]           │ [x]           │ [x]           │
   ├───┼──────┼───────────────┼───────────────┼───────────────┼───────────────┤
[-]│ 2 │      │ [x]           │ [x]           │ [x]           │ [x]           │
   ├───┼──────┼───────────────┼───────────────┼───────────────┼───────────────┤
[-]│ 3 │      │ [x]           │ [x]           │ [x]           │ [x]           │
   ├───┼──────┼───────────────┼───────────────┼───────────────┼───────────────┤
[-]│ 4 │      │ [x]           │ [x]           │ [x]           │ [x]           │
   ├───┴──────┴───────────────┴───────────────┴───────────────┴───────────────┤
   │                                     [+]                                  │
   └──────────────────────────────────────────────────────────────────────────┘

```



### AssetInstance編集画面

チェックボックス以外のセル内部をクリックすると、そのAssetInstanceの個別設定を行うためのモーダルウィンドウが表示される。このウィンドウでは、元となるAssetのデフォルト値やAssetAttr参照を個別にオーバーライドすることができる。

#### ImageAssetInstance編集画面

```
    ┌─────────────────────────────────────────────────────────────────┐
    │ My Girl (ImageAssetInstance) - Page 1                           │
    │─────────────────────────────────────────────────────────────────│
    │                                                                 │
    │  ┌─────────────────────┐             Position                   │
    │  │                     │            ┌─────────────────────────┐ │
    │  │                     │            │ ● Asset Default         │ │
    │  │                     │            │ ○ PositionAssetAttr     │ │
    │  │   Instance Preview  │            │   [立ち位置A     ▼]     │ │
    │  │                     │            │ ○ Override              │ │
    │  │    [Asset画像]      │            └─────────────────────────┘ │
    │  │                     │                                        │
    │  │                     │            Size                        │
    │  │                     │            ┌─────────────────────────┐ │
    │  └─────────────────────┘            │ ● Asset Default         │ │
    │                                     │ ○ SizeAssetAttr         │ │
    │    Z-Index                          │   [標準サイズ    ▼]     │ │
    │   ┌─────┐                           │ ○ Override              │ │
    │   │  2  │                           └─────────────────────────┘ │
    │   └─────┘                                                       │
    │                                      Transform                  │
    │    Opacity                          ┌───────┐ ┌───────┐ ┌─────┐ │
    │   ┌─────────────────┐               │Scale X│ │Scale Y│ │ Rot │ │
    │   │●──────○─────────│ 0.8           │ 1.0   │ │ 1.0   │ │ 0°  │ │
    │   └─────────────────┘               └───────┘ └───────┘ └─────┘ │
    │                                                                 │
    │    Mask (Override)                                              │
    │   ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐                           │
    │   │ Left │ │ Top  │ │Right │ │Bottom│                           │
    │   │  10  │ │  20  │ │ 758  │ │ 1004 │                           │
    │   └──────┘ └──────┘ └──────┘ └──────┘                           │
    │                                                                 │
    │                          [OK]    [Cancel]                       │
    └─────────────────────────────────────────────────────────────────┘
```

#### TextAssetInstance編集画面

```
    ┌─────────────────────────────────────────────────────────────────┐
    │ Girls Speech (TextAssetInstance) - Page 1                       │
    │─────────────────────────────────────────────────────────────────│
    │                                                                 │
    │  Text Content                       Position                    │
    │ ┌─────────────────────────────────┐ ┌─────────────────────────┐ │
    │ │ こんにちは！                    │ │ ● Asset Default         │ │
    │ │ お元気ですか？                  │ │ ○ PositionAssetAttr     │ │
    │ │                                 │ │   [セリフ位置    ▼]     │ │
    │ │                                 │ │ ○ Override              │ │
    │ │                                 │ │   X:150  Y:300          │ │
    │ │                                 │ └─────────────────────────┘ │
    │ └─────────────────────────────────┘                             │
    │                                       Font Override             │
    │    Z-Index                          ┌───────┐ ┌───────┐ ┌─────┐ │
    │   ┌─────┐                           │Size   │ │Color  │ │Outln│ │
    │   │  3  │                           │  24   │ │#000000│ │#FFF │ │ 
    │   └─────┘                           └───────┘ └───────┘ └─────┘ │
    │                                                                 │
    │    Transform                                                    │
    │   ┌───────┐ ┌───────┐ ┌─────┐         ☑ Vertical Writing        │
    │   │Scale X│ │Scale Y│ │ Rot │                                   │
    │   │ 1.0   │ │ 1.0   │ │ 0°  │                                   │
    │   └───────┘ └───────┘ └─────┘                                   │
    │                                                                 │
    │                          [OK]     [Cancel]                      │
    └─────────────────────────────────────────────────────────────────┘
```

この編集画面の特徴：

1. **参照方式の選択**：Asset Default / AssetAttr参照 / Override の3つから選択可能
2. **リアルタイムプレビュー**：Instance Previewで現在の設定を確認
3. **Z-Index管理**：レイヤー順序を数値で直接指定
4. **Transform設定**：スケール・回転を個別に調整
5. **オーバーライド機能**：必要な部分のみ個別設定可能


## Preview Window

  - Page の内容を確認するためのウィンドウ。Page がどのように見えるかを確認することができる。
  - Preview Window は、複数ページを横断的に確認できる。
  - ⌘ + マウスホイールで page の大きさが変更できる。
  - パネルの表示/非表示切り替えボタンを備えている
  - キャンバスサイズに合わせた実際のサイズ表示とスクロール機能を提供

### Preview Controls

プレビューウィンドウのヘッダーには以下のコントロールが配置されている：

- **ズームスライダー**：0.1倍から3.0倍まで段階的にズーム調整可能
- **フィットボタン（🎯アイコン）**：キャンバス全体をプレビュー画面に収める（自動ズーム・中央配置）
- **ページ情報**：現在のページ番号、アセット数、キャンバスサイズを表示

### Navigation Features

- **スクロール操作**：キャンバスが大きい場合は自動的にスクロールバーが表示
- **パン操作**：マウス中ボタン（ホイールボタン）を押しながらドラッグで自由移動
- **ズーム操作**：⌘キー + マウスホイールで拡大・縮小

```
   ┌─────────────────────────────────────────────────────────────┐
   │                                                          ┌─┐│
   │   ┌──────────────┐   ┌──────────────┐  ┌──────────────┐  │ ││
   │   │              │   │              │  │              │  │ ││
   │   │              │   │              │  │              │  │ ││
   │   │              │   │              │  │              │  │ ││
   │   │              │   │              │  │              │  │ ││
   │   │              │   │              │  │              │  │ ││
   │   │   page1      │   │   page2      │  │   page3      │  │ ││
   │   │              │   │              │  │              │  │ ││
   │   │              │   │              │  │              │  │ ││
   │   │              │   │              │  │              │  │ ││
   │   └──────────────┘   └──────────────┘  └──────────────┘  │ ││
   │                                                          │ ││
   │                                                          │ ││
   │   ┌──────────────┐   ┌──────────────┐  ┌──────────────┐  │ ││
   │   │              │   │              │  │              │  │ ││
   │   │              │   │              │  │              │  │ ││
   │   │              │   │              │  │              │  │ ││
   │   │              │   │              │  │              │  │ ││
   │   │   page4      │   │  page5       │  │   page6      │  │ ││
   │   │              │   │              │  │              │  │ ││
   │   │              │   │              │  │              │  │ ││
   │   │              │   │              │  │              │  │ ┼┼─────┐
   │   │              │   │              │  │              │  │ ││     │
   │   └──────────────┘   └──────────────┘  └──────────────┘  │ ││   scroll bar
   │                         ...                              │ ││
   │                                                          └─┘│
   └─────────────────────────────────────────────────────────────┘
```

## Implementation Details

### Technical Architecture
- **状態管理**：Zustand store (`projectStore.ts`) で `showAssetLibrary` と `showPreview` を管理
- **レイアウト**：CSS Grid を使用し、パネル表示状態に応じて動的にカラムを調整
- **アイコン**：SVGコンポーネントとして実装し、React内で再利用可能

### Key Files
- `MainLayout.tsx`：メインレイアウトとパネル切り替えロジック
- `AssetLibrary.tsx`：アセットライブラリコンポーネント（閉じるボタン・スクロール機能含む）
- `PreviewArea.tsx`：プレビューエリアコンポーネント（閉じるボタン・フィット機能・パン操作含む）
- `EnhancedSpreadsheet.tsx`：ページ管理機能が統合されたスプレッドシート（スクロール・パン機能含む）
- `PanelIcons.tsx`：SVGアイコンコンポーネント（FitToViewIcon含む）
- `MainLayout.css`：動的レイアウトスタイル
- `App.css`：共通スクロールバースタイル（.scrollbar-largeクラス）

### macOS Compatibility
- **タイトルバースタイル**：`default` を使用してウィンドウ操作の互換性を確保
- **コンテンツマージン**：システムタイトルバーとの重複を回避するよう調整

### Layout States
1. **フル表示**：全パネル表示 (`grid-template-columns: 280px 1fr 320px`)
2. **Asset非表示**：中央＋Preview (`grid-template-columns: 1fr 320px`)
3. **Preview非表示**：Asset＋中央 (`grid-template-columns: 280px 1fr`)
4. **フルスクリーン**：中央のみ (`grid-template-columns: 1fr`)

### Scrolling & Navigation
- **統一スクロールバー**：`.scrollbar-large`クラスによる一貫したスクロールバースタイル
- **動的表示**：コンテンツが領域を超える場合のみスクロールバーを表示（`overflow-y: auto`）
- **レスポンシブ幅制御**：スプレッドシートは画面幅に応じて動的に最大幅を調整
- **パン操作**：マウス中ボタンによる直感的なナビゲーション（スプレッドシート・プレビュー両対応）
