# User Interface

##  Overview

本ソフトウェアは3つのパネルで構成されている。
- Asset Library（左パネル）
- Spread Sheet（中央パネル）
- Preview Window（右パネル）

各パネルは表示/非表示を切り替えることができ、動的なレイアウト調整により効率的な作業スペースを提供する。

### 基本レイアウト（全パネル表示）
```
   ┌─────────────────┬──────────────────────────────┬─────────────────┐
   │ [◄] Asset       │        Project Heade         │    Preview [►]  │
   │                 ├──────────────────────────────┤                 │
   │                 │                              │                 │
   │  Asset Library  │       Spread Sheet           │  Preview Window │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   │                 │                              │                 │
   └─────────────────┴──────────────────────────────┴─────────────────┘
```

### 片方非表示レイアウト
```
   ┌─────────────────────────────────────────────┬─────────────────┐
   │ [◄]             Project Header              │    Preview [►]  │
   │                                             ├─────────────────┤
   │                                             │                 │
   │            Spread Sheet                     │  Preview Window │
   │                                             │                 │
   │                                             │                 │
   │                                             │                 │
   │                                             │                 │
   │                                             │                 │
   │                                             │                 │
   │                                             │                 │
   │                                             │                 │
   └─────────────────────────────────────────────┴─────────────────┘
```

### フルスクリーンレイアウト（両パネル非表示）
```
   ┌─────────────────────────────────────────────────────────────┐
   │ [◄]             Project Header                       [►]    │
   ├─────────────────────────────────────────────────────────────┤
   │                                                             │
   │                     Spread Sheet                            │
   │                                                             │
   │                                                             │
   │                                                             │
   │                                                             │
   │                                                             │
   │                                                             │
   │                                                             │
   │                                                             │
   └─────────────────────────────────────────────────────────────┘
```

Created by [Ascii Flow](https://asciiflow.com/#/)

## Menu Bar

OS 提供のメニューバーが存在し、そこから新規プロジェクトの作成や、プロジェクトの保存、エクスポートなどを行うことができる。

- Extension
  - Custom Fonts
  - Custom Assets (予定)
- File
  - New Project
  - Open Project
  - Save Project
  - Export Project
- Edit
  - Undo
  - Redo
  - Cut
  - Copy
  - Paste
- Help
  - Documentation
  - Release Notes

## Project Header

```
   ┌─────┬──────────┬─────────┬─────────┬───┬─────────────────────────┬─────┐
   │ [◄] │   P:[🖊️] │ [JA|▼]  │  T:[🖊️] │ F │                         │ [►] │
   ├─────┴──────────┴─────────┴─────────┴───┴─────────────────────────┴─────┤
```

Project Header は、プロジェクト全体に横断した設定や表示設定をするためのボタンが配置される。
- `[◄]` はアセットライブラリを表示するためのトグルボタンで、クリックすると左パネルの Asset Library の表示/非表示を切り替える。
- `[►]` はプレビューウィンドウを表示するためのトグルボタンで、クリックすると右パネルの Preview Window の表示/非表示を切り替える。
- `P:[🖊️]` は、プロジェクト全体の設定の編集を画面を表示する。表示されるウィンドウは「Project Creation」とほぼ同じものだが、「作成」ではなく「更新」ボタンになる。実際には`P`は P のアイコン
- `T:[🖊️]` を押下すると「TextAsset Bulk Edit Screen」が表示される。後述。
- `[JA|▼]` は、プロジェクトの言語コードを選択するためのドロップダウンメニューで、現在の言語コードが表示される。プロジェクト作成時に指定した言語コードが表示される。言語コードを選択すると、Spread Sheet に存在する全ての TextAssetInstance の言語が切り替わる。
- `F` をクリックすると、Custom Fonts の画面が開く

## Project Creation

```
    ┌────────────────────────────────────────┐
    │  Project Name                          │
    │  ┌──────────────────────────────────┐  │
    │  │                                  │  │
    │  └──────────────────────────────────┘  │
    │  Description                           │
    │  ┌──────────────────────────────────┐  │
    │  │                                  │  │
    │  │                                  │  │
    │  │                                  │  │
    │  │                                  │  │
    │  └──────────────────────────────────┘  │
    │             ┌────────────────┬───┐     │
    │   Lang      │ JA (Japanese)  │ v │[?]  │
    │             └────────────────┴───┘     │
    │   ┌────────────────────────────────┐   │
    │   │┌──┬─┐┌──┬─┐┌──┬─┐              │   │
    │   ││JA│x││EN│x││ZH│x│              │   │ <-- Lang Code Box
    │   │└──┴─┘└──┴─┘└──┴─┘              │   │
    │   │                                │   │
    │   └────────────────────────────────┘   │
    │  Canvas Size                           │
    │  ┌──────────────────────────────────┐  │
    │  │ o 縦長(3:4)                      │  │
    │  └──────────────────────────────────┘  │
    │  ┌──────────────────────────────────┐  │
    │  │ o 縦長(9:16)                     │  │
    │  └──────────────────────────────────┘  │
    │  ┌──────────────────────────────────┐  │
    │  │ o 横長(4:3)                      │  │
    │  └──────────────────────────────────┘  │
    │  ┌──────────────────────────────────┐  │
    │  │ o 横長(16:9)                     │  │
    │  └──────────────────────────────────┘  │
    │  ┌──────────────────────────────────┐  │
    │  │ o スクエア                       │  │
    │  └──────────────────────────────────┘  │
    │  ┌──────────────────────────────────┐  │
    │  │ o カスタム                       │  │
    │  └──────────────────────────────────┘  │
    │                           ┌────────┐   │
    │                           │  作成  │   │
    │                           └────────┘   │
    └────────────────────────────────────────┘
```

Lang Code は、プロジェクトの言語コードを選択するためのもので、JA（日本語）、EN（英語）、ZH（中国語）などが選べる。
`[?]` ボタンをクリックすると、この Lang の説明がポップアップで表示される。
この言語コードは、TextAsset が持つ状態の一部であり、作品の対応言語を示す。

ISO 639-1 の言語コード一覧がプルダウンで表示され、クリックすると Lang Code Box に追加がされる。
複数の言語を登録することができ、Lang Code Box に追加される。`x`はバツのボタンで、クリックするとその言語コードを Lang Code Box から削除する。Lang Code Box にマウスカーソルをホバーすると、その言語コードの説明がポップアップで表示される。


## Panel Toggle System

### Dynamic Button Positioning

各パネルの表示切り替えボタンは、表示状態に応じて動的に位置を変更する：

#### Asset Library Toggle
- **閉じるボタン**：アセットライブラリ内のヘッダー左側
- **開くボタン**：中央パネルのツールバー左側（プロジェクト名の左）

#### Preview Window Toggle  
- **閉じるボタン**：プレビューウィンドウ内のヘッダー右側
- **開くボタン**：中央パネルのツールバー右側（プロジェクト名の右）

### SVG Icons

パネル切り替えボタンには、以下のSVGアイコンを使用：
- `PanelCollapseLeftIcon`：アセットライブラリ閉じるボタン
- `PanelExpandLeftIcon`：アセットライブラリ開くボタン  
- `PanelCollapseRightIcon`：プレビューウィンドウ閉じるボタン
- `PanelExpandRightIcon`：プレビューウィンドウ開くボタン
- `FitToViewIcon`：プレビューウィンドウのフィット表示ボタン

アイコンは`currentColor`を使用してテーマ一貫性を保ち、ホバー効果にも対応している。

## Asset Window

  - Asset（テンプレート）を管理する場所。entity.md参照。
  - 画像ファイルをドラッグアンドドロップしたり、メニューバーから新規作成したりすることで Asset を追加することができる。
  - Asset のアイコンは以下の様になる
    - ImageAsset ... 登録されている画像を縮小したもの
    - TextAsset ... 「T」の文字が書かれたアイコン
  - パネルの表示/非表示切り替えボタンを備えている
  - **縦スクロール機能**：多数のアセットがある場合は自動的に縦スクロールバーが表示される

```
    ┌───────────────────┐
    │                   │
    │   ┌───────────┐   │
    │   │ Asset 1   │   │
    │   └───────────┘   │
    │   ┌───────────┐   │
    │   │ Asset 2   │   │
    │   └───────────┘   │ 
    │   ┌───────────┐   │
    │   │ Asset 3   │   │
    │   └───────────┘   │
    │   ┌───────────┐   │
    │   │ Asset 4   │   │
    │   └───────────┘   │
    │   ┌───────────┐   │
    │   │ Asset 5   │   │
    │   └───────────┘   │
    │       ...         │
    └───────────────────┘
```

### Asset Management

それぞれのアセットは、種類ごとに異なる特性を持つ。
Asset Window 上でダブルクリックすることで、画面全体がアセットの編集ウィンドウに切り替わる。

#### ImageAsset

最も本ソフトウェアで利用されるであろうアセット
Asset Window で画像ファイルをドラッグアンドドロップすることで作成される。
さらに Asset Window 上でダブルクリック、あるいは右クリックからメニューを出して「Edit」を選ぶと、詳細を編集するウィンドウが開く。以下のような感じ。

```
      ┌─────────────────────────────────────────────────────────────┐
      │                                                             │
      │                                   Asset Name                │
      │                                        ┌────────────────┐   │
      │                                        │                │   │
      │                                        └────────────────┘   │
      │    ┌─────────────────────┐        Original Width/Height     │
      │    │    Image Preview    │            ┌───────┐┌───────┐    │
      │    │                     │            │  100  ││   200 │    │
      │    │   o------------o    │            └───────┘└───────┘    │
      │    │   |            |    │        Default Width/Height      │
      │    │   |            |    │      [ ] 縦横比を元画像にあわせる│
      │    │   o------------o    │            ┌───────┐┌───────┐    │
      │    │                     │            │       ││       │    │
      │    │                     │            └───────┘└───────┘    │
      │    │                     │          Default PosX/PosY       │
      │    └─────────────────────┘            ┌───────┐┌───────┐    │
      │                                       │       ││       │    │
      │                                       └───────┘└───────┘    │
      │                                     Default Opacity         │
      │                                       o─[]────────────o     │
      │                                     Edit Mask [🖊️]          │
      └─────────────────────────────────────────────────────────────┘
```

Image Preview のフレームはキャンバスサイズの縦横比率にあわせて表示される。
Original Width/Height はグレーアウトしており、編集できない。
Original Width/Height のテキストボックスは、0以下の値を入力することはできない。
ただ、一時的に編集で空白にできる。が、マウスのフォーカスを外したときにバリデーションがされ、不正な値が入力されている場合は、元の値に戻される。
整数だけではなく、少数第2位までの数字を入力することができる。

Default Width/Height は、編集ができる項目で、ここで指定した値が ImageAsset のデフォルト値として保存される。
Default Width/Height のテキストボックスは、0以下の値を入力することはできるが、数字と`-`と`.`以外の文字は入力することはできない。
整数だけではなく、少数第2位までの数字を入力することができる。
ただ、一時的に編集で空白にできる。が、マウスのフォーカスを外したときにバリデーションがされ、不正な値が入力されている場合は、元の値に戻される。

「[ ] 縦横比を元画像にあわせる」のチェックボックスは、チェックを入れると、Default Width/Height の値を変更した際に、元画像の縦横比を維持するように自動的に計算される。Default PosX/PosY は、画像のデフォルトの位置を指定する項目で、ここで指定した値が ImageAsset のデフォルト値として保存される。

以下の領域は、マウスでのドラッグ操作で、画像の位置や大きさを変更することができる。
`o` の箇所はドラッグ可能なハンドルで、画像の位置や大きさを変更することができる。
実際に`o`の箇所は、画面上では四角形の図形として表示される。
この`o`の箇所をドラッグする最中に Shift キーを押すと、その時点のサイズの縦横比を維持したまま大きさを変更することができる。
矩形の内側は ImageAsset の画像が表示される領域で、画像の大きさや位置を確認することができる。
さらに矩形の内側自体もドラッグ可能で、画像の位置を変更することができる。

```
o------------o
|            |
|            |
o------------o
```

ペンのマークをクリックすると、下のマスク編集画面が開く。

マスク編集:
```
      ┌───────────────────────────────────────────────────────────┐
      │                                 Default Mask              │
      │    ┌─────────────────────┐      ┌───────┐      ┌───────┐  │
      │    │    Image Preview    │  P1:x│       │ P1:y │       │  │
      │    │                     │      └───────┘      └───────┘  │
      │    │   0------------0    │      ┌───────┐      ┌───────┐  │
      │    │   |            |    │  P2:x│       │ P2:y │       │  │
      │    │   |            |    │      └───────┘      └───────┘  │
      │    │   0------------0    │      ┌───────┐      ┌───────┐  │
      │    │                     │  P3:x│       │ P3:y │       │  │
      │    │                     │      └───────┘      └───────┘  │
      │    │                     │      ┌───────┐      ┌───────┐  │
      │    └─────────────────────┘  P4:x│       │ P4:y │       │  │
      │                                 └───────┘      └───────┘  │
      │                                                           │
      │                                Exit Mask Editor [<-]      │
      │                                                           │
      └───────────────────────────────────────────────────────────┘
```

マスク編集画面では、マスク領域を矩形で指定できる。
「Exit Mask Editor」をクリックすると、元の ImageAsset 編集画面に戻る。
それぞれの座標のテキストボックスは、0以下の値を入力することはできるが、数字と`-`と`.`以外の文字は入力することはできない。
整数だけではなく、少数第2位までの数字を入力することができる。
ただ、一時的に編集で空白にできる。が、マウスのフォーカスを外したときにバリデーションがされ、不正な値が入力されている場合は、元の値に戻される。

このマスク編集画面では、画像の表示領域を矩形で指定することができる。
マスクの矩形は、4つのポイント（P1, P2, P3, P4）で定義され、それぞれの座標を指定することができる。
`0` の箇所は、マスクの矩形の角を表しており、ドラッグ操作で位置を変更することができる。
この画面を開いた時の P1〜P4 の座標はキャンバスサイズの４点になっている。

```
0------------0
|            |
|            |
0------------0
```

このマスクの編集画面の矩形の範囲にのみ、画像が表示されるようになる。
マスクの編集画面では、上記の矩形の外側の範囲は、薄い白色で表示され、マスクの範囲がわかりやすくなっている。以下のドットが薄い白色の範囲。
`+` で囲まれた部分がImageAssetの画像、`0` で囲まれた部分がマスクの矩形の範囲を表す。
重要なのは、ImageAssetの画像もしっかりと表示されていること。


```
┌───────────────────────────────┐
│...............................│
│...+----------------------+....│
│...|......................|....│
│...|....0------------0....|....│
│...|....|            |....|....│
│...|....|            |....|....│
│...|....0------------0....|....│
│...|......................|....│
│...+----------------------+....│
│...............................│
└───────────────────────────────┘
```

なお、マスクの四隅のデザインは簡略化のために`0`としてたが、
実際には以下のように矩形の内側に内接した四角形のような形状をしていることにする。

```
   ┌─────┐────────────────┌─────┐  
   │     │                │     │  
   └─────┘                └─────┘  
   │                            │  
   │                            │  
   │                            │  
   │                            │  
   │                            │  
   ┌─────┐                ┌─────┐  
   │     │                │     │  
   └─────┘────────────────└─────┘  
```


マスクのデフォルト値はキャンバスの四隅のため、上記のようなデザインにしないと初期位置からドラッグがしにくいためである。

## Spread Sheet Window

本ソフトウェアの特徴的な特性は、複数 Page での横断編集が極めて容易であること。
- UI 上の Spread Sheet には、Microsoft Excel のような格子状の表形式のエディタがあり、複数の Page にまたがる AssetInstance の情報を編集することができる。
- それぞれの行は Page を表し、列は Asset（テンプレート）を表す。
- ある Page で特定の AssetInstance を作成した場合、セルに元となった Asset の列が表示される。
- ページ管理機能が統合されており、従来の独立したPageListコンポーネントは不要になった。
- 例えば
  - Asset Window に画像ファイルをドロップして、「My Girl」という ImageAsset を作成
  - 「My Girl」をSpread Sheet にドロップする
  - すると、My Girl の列が Spread Sheet に追加される。
  - 各セルにはチェックボックスが表示され、チェックを入れることで AssetInstance を Page 上に配置することができる。
  - また、チェックボックス以外のセル内部の場所をクリックすることで、AssetInstance の個別設定（位置のオーバーライド、AssetAttr参照の変更、透明度調整など）を行うためのウィンドウがモーダルとして表示される
  - 列のタイトルをクリックすることで、Excel のように、列全体を選択することができる
  - 列のタイトルを右クリックすることで、非表示にすることができる。例えば背景画像など、常に表示して編集する必要がない場合は、非表示にしておくことができる。
  - 列をドラッグすることで、列の順番を変更することができる。
  - [+] ボタンをクリックすることで、新たにページを追加することができる。
  - Preview の列には各ページのプレビューが表示される。プレビューは、ページの内容を確認するためのもので、クリックすることで Preview Window でそのページが表示される。
  - `#` の列には、ページの番号が表示される。
  - ページの順番は、Spread Sheet 上でドラッグアンドドロップで変更することができる。
  - `#` の列の横にある `[x]` ボタンをクリックすることで、そのページを削除することができる。UI上はXボタンのように表示される。
  - **スクロール機能**：多数のページ・アセットがある場合は縦・横スクロールバーが表示される
  - **パン機能**：マウス中ボタン（ホイールボタン）を押しながらドラッグすることで自由自在にパン操作が可能
  - 各セルにある `[✔]` はチェックボックスで、その AssetInstance の表示の ON/OFF を切り替えらえっる。
  - 各セルにある `[%]` は編集ボタンで、そのボタンをクリックするとモーダルウィンドウが表示され、AssetInstance の個別設定を行うことができる。
    - 実際に `[%]` は本ドキュメントで便宜上表記しているもので、実際の UI では `🖊️` のようなペンのアイコンが表示される。

```
     #  Preview  My Girl        Background       Girls Speech     Effect
   ┌───┬──────┬────────────────┬────────────────┬────────────────┬────────────────┐
   │   │      │ [✔] |          │ [✔] |          │ [✔] |          │ [✔] |          │
[x]│ 1 │      │ [%] |          │ [%] |          │ [%] |          │ [%] |          │
   │   │      │     |          │     |          │     |          │     |          │
   ├───┼──────┼────────────────┼────────────────┼────────────────┼────────────────┤
   │   │      │ [✔] |          │ [✔] |          │ [✔] |          │ [✔] |          │
[x]│ 2 │      │ [%] |          │ [%] |          │ [%] |          │ [%] |          │
   │   │      │     |          │     |          │     |          │     |          │
   ├───┼──────┼────────────────┼────────────────┼────────────────┼────────────────┤
   │   │      │ [✔] |          │ [✔] |          │ [✔] |          │ [✔] |          │
[x]│ 3 │      │ [%] |          │ [%] |          │ [%] |          │ [%] |          │
   │   │      │     |          │     |          │     |          │     |          │
   ├───┼──────┼────────────────┼────────────────┼────────────────┼────────────────┤
   │   │      │ [✔] |          │ [✔] |          │ [✔] |          │ [✔] |          │
[x]│ 4 │      │ [%] |          │ [%] |          │ [%] |          │ [%] |          │
   │   │      │     |          │     |          │     |          │     |          │
   ├───┴──────┴────────────────┴────────────────┴────────────────┴────────────────┤
   │                                      [+]                                     │
   └──────────────────────────────────────────────────────────────────────────────┘
```


## Cell

それぞれのセルは、以下のようなレイアウトになっている。
左右に範囲が別れており、左右の領域が線で分割されている。
左側を cell-manage と呼ぶ
右側を cell-preview と呼ぶ。

- cell-manage にはチェックボックスと編集ボタンが縦に並んでいる。
- cell-content には、AssetInstance の種類ごとに内容が異なる領域。
- 基本的にはその AssetInstance の概要が表示される。
- セルの右上には右上のセルの頂点に内接する三角形が描画される `＼` は三角形の底辺を表す。実際の画面上は内接するように青い三角形が描画される。
  - この三角形は、そのセルが表す Asset の内容が AssetInstance 側で override されていることを示す。もしひとつでも Asset の属性が AssetInstance 側でオーバーライドされている場合は、この三角形が表示される。

```
cell-manage <- -> cell-content
        ┌────────────────┐
        │ [✔] |        ＼│
        │ [%] |          │
        │     |          │
        └────────────────┘
```

ImageAssetInstance の場合、cell-content にはその画像の小さなプレビューが表示される。

```
┌────────────────┐
│ [✔] |  ┌────┐  │
│ [%] |  │    │  │
│     |  └────┘  │
└────────────────┘
```

TextAssetInstance の場合、cell-content にはその Asset のテキスト (default_text ないし override_text) が表示される。SVG ではなくプレーンテキストで表示される。

```
┌────────────────┐
│ [✔] |HELLO     │
│ [%] |WORLD     │
│     |          │
└────────────────┘
```

## Column

列のヘッダ部分を右クリックするとメニューが出現し、その列全体に対してバルク操作を行うことができる。
右クリックを開いている間、その列全体はハイライトされ、どの列に対して操作を行うかがわかりやすくなっている。
例えば、以下の例で、Background と書いてあるあたりを右クリックする

```
...+----------------+...
...| Background     |...
...┬────────────────┬...
...│ [✔] |          │...
...│ [%] |          │...
...│     |          │...
...┼────────────────┼...
...│ [✔] |          │...
...│ [%] |          │...
...│     |          │...
...┼────────────────┼...
...│ [✔] |          │...
...│ [%] |          │...
...│     |          │...
...┴────────────────┴...
```

と、ImageAsset の場合は以下のメニューが表示される。

- 全て表示
   ... 列の全てのセルに対してチェックボックスを ON にする
- 全て隠す
   ... 列の全てのセルに対してチェックボックスを OFF にする
- 全て変更リセット
   ... 列の全てのセルに対して個別設定をリセットする（Asset のデフォルト値に戻すため、AssetInstance の overwrite_... の属性は全て undefined になる）

## Row

行の先頭を右クリックしたら、列単位のバルク操作ができるようになる。
内容は、Column 単位のバルク操作と同様。
それに加えて「上に挿入」「下に挿入」「削除」のメニューも表示して、行の追加・削除ができるようにする。

- 全て表示
   ... 行の全てのセルに対してチェックボックスを ON にする
- 全て隠す
   ... 行の全てのセルに対してチェックボックスを OFF にする
- 全て変更リセット
   ... 行の全てのセルに対して個別設定をリセットする（Asset のデフォルト値に戻すため、AssetInstance の overwrite_... の属性は全て undefined になる）
- 上に挿入
   ... 行の上に新しい行を挿入する
- 下に挿入
   ... 行の下に新しい行を挿入する
- 削除
   ... 行を削除する。ページ番号は詰められ、削除された行の下の行は上に詰められる。

### AssetInstance編集画面

cell-manage の `[%]` をクリックすると、そのAssetInstanceの個別設定を行うためのモーダルウィンドウが表示される。このウィンドウでは、元となるAssetのデフォルト値やAssetAttr参照を個別にオーバーライドすることができる。

#### ImageAssetInstance編集画面

```
      ┌───────────────────────────────────────────────────────────┐
      │ Background - Page 1                                       │
      ├───────────────────────────────────────────────────────────┤
      │                                                           │
      │                                                           │
      │                                                           │
      │                                                           │
      │                                                           │
      │   ┌─────────────────────┐       Original Width/Height     │
      │   │    Image Preview    │           ┌───────┐┌───────┐    │
      │   │                     │           │  100  ││   200 │    │
      │   │   o------------o    │           └───────┘└───────┘    │
      │   │   |            |    │       Default Width/Height      │
      │   │   |            |    │     [ ] 縦横比を元画像にあわせる│
      │   │   o------------o    │           ┌───────┐┌───────┐    │
      │   │                     │           │       ││       │    │
      │   │                     │           └───────┘└───────┘    │
      │   │                     │         Default PosX/PosY       │
      │   └─────────────────────┘           ┌───────┐┌───────┐    │
      │                                     │       ││       │    │
      │                                     └───────┘└───────┘    │
      │                                   Default Opacity         │
      │                                     o─[]────────────o     │
      │                                   Edit Mask [🖊️]          │
      └───────────────────────────────────────────────────────────┘
```

ペンのマークをクリックすると、下のマスク編集画面が開く。

マスク編集:
```
      ┌───────────────────────────────────────────────────────────┐
      │ Background - Page 1                                       │
      ├───────────────────────────────────────────────────────────┤
      │                                 Default Mask              │
      │    ┌─────────────────────┐      ┌───────┐      ┌───────┐  │
      │    │    Image Preview    │  P1:x│       │ P1:y │       │  │
      │    │                     │      └───────┘      └───────┘  │
      │    │   0------------0    │      ┌───────┐      ┌───────┐  │
      │    │   |            |    │  P2:x│       │ P2:y │       │  │
      │    │   |            |    │      └───────┘      └───────┘  │
      │    │   0------------0    │      ┌───────┐      ┌───────┐  │
      │    │                     │  P3:x│       │ P3:y │       │  │
      │    │                     │      └───────┘      └───────┘  │
      │    │                     │      ┌───────┐      ┌───────┐  │
      │    └─────────────────────┘  P4:x│       │ P4:y │       │  │
      │                                 └───────┘      └───────┘  │
      │                                                           │
      │                                Exit Mask Editor [<-]      │
      │                                                           │
      └───────────────────────────────────────────────────────────┘
```

基本的には ImageAsset の編集画面と同様の内容。


#### TextAsset 編集画面


左側の text-preview には SVG で描画されたテキストが表示される。
SVG の描画方法については、svg-structure.md を参照。
text-input には、直接テキストボックスがあり、複数行の入力が可能になっている。

Font はプルダウンボックスになっており、フォントが選択できる。
`[v]` はドロップダウンメニューを開くためのアイコンである。実際は三角形の頂点が下を向いているアイコンが表示される。

Font Size、Stroke Width、PosX、PosY、Leading、Rotate、Z-Index はそれぞれの設定値を入力するための項目である。
マイナス値は許容されず、正の整数値のみが許容される。
Opacity はスライダーで調整することができ、0から100までの値を設定することができる。
Vertical Writing はチェックボックスで、チェックを入れると縦書きのテキストが表示される。

Color Stroke、Color はそれぞれの色を選択するための項目で、カラーピッカーが表示される。
`[/]` はカラーピッカーを開くためのアイコンである。

`[Save]` ボタンは、設定を保存するためのボタンである。

```
    ┌────────────────────────────────────────────────────────────┐
    │ Girls Speech - Page 1                                  [x] │
    ├────────────────────────────────────────────────────────────┤
    │                              |                             │
    │  text-preview                | text-input                  │
    │ ┌─────────────────────────┐  | ┌─────────────────────────┐ │
    │ │                    H    │  | │ HELLO                   │ │
    │ │                W   E    │  | │ WORLD                   │ │
    │ │                O   L    │  | │                         │ │
    │ │                R   L    │  | │                         │ │
    │ │                L   O    │  | │                         │ │
    │ │                D        │  | │                         │ │
    │ │                         │  | │                         │ │
    │ └─────────────────────────┘  | └─────────────────────────┘ │
    │                              |                             │
    │                              |         ┌───────────┐       │
    │                              |  Font : │  Default  │ [v]   │
    │                              |         └───────────┘       │
    │                              |               ┌─────┐       │
    │                              |    Font Size :│     │       │
    │                              |               └─────┘       │
    │                              |               ┌─────┐       │
    │                              | Stroke Width :│     │       │
    │                              |               └─────┘       │
    │                              |    PosX   : PosY            │
    │                              |   ┌─────┐  ┌─────┐          │
    │                              |   └─────┘  └─────┘          │
    │                              | Color Stroke:               │
    │                              |   ┌───────────────┐         │
    │                              |   │ #FFFFFF       │ [/]     │
    │                              |   └───────────────┘         │
    │                              | Color:                      │
    │                              |   ┌───────────────┐         │
    │                              |   │ #FFFFFF       │ [/]     │
    │                              |   └───────────────┘         │
    │                              |           ┌────┐            │
    │                              |  Leading: │ 0  │            │
    │                              |           └────┘            │
    │                              |           ┌────┐            │
    │                              |  Rotate:  │ 0  │            │
    │                              |           └────┘            │
    │                              |  Opacity:                   │
    │                              |    o─[]────────────o        │
    │                              |                             │
    │                              |  ☑ Vertical Writing         │
    │                              |           ┌────┐            │
    │                              |  Z-Index: │ 0  │            │
    │                              |           └────┘            │
    │                              |                             │
    │                              |          [Save]             │
    └────────────────────────────────────────────────────────────┘
```


#### TextAssetInstance編集画面

TextAsset から TextAssetInstance において override できる項目のみが表示される。

## Preview Window

  - Page の内容を確認するためのウィンドウ。Page がどのように見えるかを確認することができる。
  - Preview Window は、複数ページを横断的に確認できる。
  - ⌘ + マウスホイールで page の大きさが変更できる。
  - パネルの表示/非表示切り替えボタンを備えている
  - キャンバスサイズに合わせた実際のサイズ表示とスクロール機能を提供

### Preview Controls

プレビューウィンドウのヘッダーには以下のコントロールが配置されている：

- **ズームスライダー**：0.1倍から3.0倍まで段階的にズーム調整可能
- **フィットボタン**：キャンバス全体をプレビュー画面に収める（自動ズーム・中央配置）
  - ズームスライダーの横にはフィットボタンがある。
  - 図には `[-@-]` というアイコンがあるが、実際は四角形が二重になり、内側の四角形の四方向から線が外側の四角形に内接しているデザインをしている。
  - フィットボタンをトグルスイッチにして、トグルが ON の間は Preview Window のサイズにあわせて自動的にキャンバスがズームするようになる。起動時にフィットボタンは ON の状態。
  - ズームスライダーを動かすと、フィットボタンは自動的に OFF になる。
- **ページ情報**：現在のページ番号、アセット数、キャンバスサイズを表示

### Navigation Features

- **スクロール操作**：キャンバスが大きい場合は自動的にスクロールバーが表示
- **パン操作**：マウス中ボタン（ホイールボタン）を押しながらドラッグで自由移動
- **ズーム操作**：⌘キー + マウスホイールで拡大・縮小

```
   ┌─────────────────────────────────────────────────────────────┐
   │  Preview                                                    │
   │  倍率:  o─[]────────────o 100%  [-@-]                       │
   │                              Page N: Assets:N  NNNxNNN px   │
   ├─────────────────────────────────────────────────────────────┤
   │                                                          ┌─┐│
   │                                                          │ ││
   │                                                          │ ││
   │                                                          │ ││
   │            ┌─────────────────────┐                       │ ││
   │            │                     │                       │ ││
   │            │                     │                       │ ││
   │            │                     │                       │ ││
   │            │                     │                       │ ││
   │            │                     │                       │ ││
   │            │   page content      │                       │ ││
   │            │                     │                       │ ││
   │            │                     │                       │ ││
   │            │                     │                       │ ││
   │            └─────────────────────┘                       │ ││
   │                                                          │ ││
   │                                                          │ ┼┼─────┐
   │                                                          │ ││     │
   │                                                          │ ││   scroll bar
   │                                                          │ ││
   │                                                          └─┘│
   └─────────────────────────────────────────────────────────────┘
```

## Font management

TextAsset/TextAssetInstance で利用されるフォントには 2 種類が存在する

- アプリケーションのビルトインで存在するフォント
- ユーザが追加したカスタムフォント

Menu Bar から Custom Fonts を選択すると、カスタムフォントの管理画面が表示される。
画面や以下のようなレイアウトになっている。
Sample Text はテキストボックスとなっており、ユーザが任意の文章を入力できる。
その下に、フォントの文字列を表示するための領域があり、そこに Sample Text の内容が表示される。
以下の例の「Rounded-X M+ 1p」や「Mansalva」は、ソフトウェアのビルトインのフォントの例である。
`[LICENSE]` をクリックすると、フォントのライセンス情報を表示する。

```
   ┌────────────────────────────────────────────────────────────────────────┐ 
   │                                                                     [x]│ 
   │                                                                        │ 
   │   Sample Text                                                          │ 
   │  ┌───────────────────────────────────────────────────────────┐         │ 
   │  │ HELLO WORLD                                               │         │ 
   │  └───────────────────────────────────────────────────────────┘         │ 
   │  ┌─────────────────────────────────────────────────────────────────┐   │ 
   │  │                                                                 │   │ 
   │  │  ┌───────────────────────────────────────────────────────────┐  │   │ 
   │  │  │ Rounded-X M+ 1p                                  [LICENSE]│  │   │ 
   │  │  │ HELLO WORLD                                               │  │   │ 
   │  │  │                                                           │  │   │ 
   │  │  └───────────────────────────────────────────────────────────┘  │   │ 
   │  │  ┌───────────────────────────────────────────────────────────┐  │   │ 
   │  │  │ Mansalva                                         [LICENSE]│  │   │ 
   │  │  │ HELLO WORLD                                               │  │   │ 
   │  │  │                                                           │  │   │ 
   │  │  └───────────────────────────────────────────────────────────┘  │   │ 
   │  │   ...                                                           │   │ 
   │  └─────────────────────────────────────────────────────────────────┘   │ 
   │                         ┌──────────────────┐  ┌─────────────────┐      │ 
   │                         │  Delete Font     │  │  Add Font       │      │ 
   │                         └──────────────────┘  └─────────────────┘      │ 
   └────────────────────────────────────────────────────────────────────────┘ 
```

ビルトインフォントの管理方法については ./docs/fonts.md を参照。

フォントの矩形をユーザはクリックすることができ、その状態で「Delete Font」ボタンをクリックすると、そのフォントが削除される。
ただし、ビルトインのフォントは削除できない。
また、「Add Font」ボタンをクリックすると、以下の画面が開く。

```
  ┌────────────────────────────────────────────────────────────┐
  │  (o) File   ( ) <link> [?]                                 │
  │  ┌──────────────────────────────────────────────────────┐  │
  │  │    Font File                                         │  │
  │  │           ┌────────────────────────────────────┐     │  │
  │  │           │                                    │ [📁]│  │
  │  │           └────────────────────────────────────┘     │  │
  │  │    License File [?]                                  │  │
  │  │           ┌────────────────────────────────────┐     │  │
  │  │           │                                    │ [📁]│  │
  │  │           └────────────────────────────────────┘     │  │
  │  │                                                      │  │
  │  └──────────────────────────────────────────────────────┘  │
  │                                                            │
  │      ┌───────────┐ ┌───────────┐                           │
  │      │   Add     │ │  Cancel   │                           │
  │      └───────────┘ └───────────┘                           │
  └────────────────────────────────────────────────────────────┘
```

Font File を選択すると、ユーザがローカルのフォントファイル（ttf, otf など）を選択するダイアログが開き、選択したフォントが追加される。
License File は、フォントのライセンス情報を記載したテキストファイルを選択するためのものである。
この Lisense File は、フォントファイルと同じ名前でなければならない。

`[?]` はUI上は丸で囲んだ`?`であり、クリックすると、フォントのライセンス情報の利用用途は、利用時の注意が表示される。以下のような説明。
  - フォントは HTML ファイルでのエクスポート時にファイルに埋め込まれる
  - HTML ファイルのビューワーに、著作権表示がされるページも追加される
  - フォントを利用する際には、ライセンス情報を確認することが推奨される
  - 特に、商用利用が可能かどうか、組み込み利用が可能かどうか、再配布が可能かどうかを確認することをよく確認すること

ここに追加したフォントが、TextAsset/TextAssetInstance のフォント選択のドロップダウンメニューに表示される。
また、ここに追加したフォントかつ、プロジェクト内で TextAsset/TextAssetInstance で利用されているフォントは、プロジェクトの保存時に font ディレクトリ内に一緒に保存される。
加えて、HTML ファイルでのエクスポート時には、 CSS の箇所に　Base64 としてフォントが埋め込まれる（html-export.md参照）。

ビルトインのフォントの管理方法については、./docs/fonts.md を参照。

さらに上記の画面は `(o) File   ( ) <link>` というアイコンがあるが、これはフォントファイルをローカルのファイルシステムから選択するか、あるいは URL を指定して組み込むかを選択するためのものである。
ラジオボタンをクリックすることで、どちらかを選択できる。
もしも `<link>` を選択した場合、フォントファイルの URL を入力するためのテキストボックスが表示される。
以下のような画面になる。

```
  ┌──────────────────────────────────────────────────────────────────────────┐
  │  ( ) Embed   (o) Google Fonts                                            │
  │  ┌────────────────────────────────────────────────────────────────────┐  │
  │  │   Google Font URL [?]                                              │  │
  │  │           ┌──────────────────────────────────────────────────┐     │  │
  │  │           │ https://fonts.googleapis.com/css2?family=My+Font │     │  │
  │  │           └──────────────────────────────────────────────────┘     │  │
  │  └────────────────────────────────────────────────────────────────────┘  │
  │                                                                          │
  │      ┌───────────┐ ┌──────────┐                                          │
  │      │   Add     │ │  Cancel  │                                          │
  │      └───────────┘ └──────────┘                                          │
  └──────────────────────────────────────────────────────────────────────────┘
```

`Google Fonts URL` の部分は、HTML ファイルの `<head>` セクションに追加するためのGoogle Font のURLを入力するためのテキストボックスである。
デフォルトでは、Google Fonts のフォントを利用するためのURLがサンプルとして薄い灰色（input タグの placeholder のようなデザイン）で表示されている。
`[?]` の箇所（実際は円で`?`を囲んだ青いアイコン）クリックすると、Google Fonts の利用方法についての説明が表示される。
以下のような説明が表示される。

"""
フォントのファイルを指定せず、[Google Fonts](https://fonts.google.com/) の提供するフォントを利用できます。
HTML ファイルでのエクスポート時には、Google Fonts のフォントを利用するための CSS の記述が自動的に追加されます。
**しかし、フォントの配布元がフォントの提供を停止した場合、フォントが表示されなくなる可能性がある点は注意してください。**

Google Fonts を利用する場合は、Goole Fonts の「Web」の `<link>` の箇所を開き、以下のような記述から URL の箇所をコピーして、上記のテキストボックスに貼り付ける。
以下のような記述の場合、`https://fonts.googleapis.com/css?family=Example+Font` の部分をコピーしてください。

```html
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css?family=Example+Font" rel="stylesheet">
```
"""

説明文の箇所をクリックすると、Alert ダイアログではなく、現在表示中のモーダルの表示が切り替わる。
以下のような形。
Close をクリックすると前の画面に戻る。

```
  ┌──────────────────────────────────────────────────────────────────────────┐
  │  ┌────────────────────────────────────────────────────────────────────┐  │
  │  │                                                                    │  │
  │  │                                                                    │  │
  │  │                                                                    │  │
  │  │   説明文                                                           │  │
  │  │                                                                    │  │
  │  │                                                                    │  │
  │  │                                                                    │  │
  │  └────────────────────────────────────────────────────────────────────┘  │
  │                           ┌───────────┐                                  │
  │                           │   Close   │                                  │
  │                           └───────────┘                                  │
  └──────────────────────────────────────────────────────────────────────────┘
```



## TextAsset Bulk Edit Screen

Project Header にある `TextAsset Bulk Edit` ボタンをクリックすると、TextAsset の一括編集画面が表示される。
これは、現在のプロジェクト内に存在する TextAssetInstance の一覧を表示し、各 TextAssetInstance のテキストをページごとに一括でyaml 形式でエクスポート/インポートする機能である。

この機能の狙いとして、複数言語のテキストの一括の編集は、スプレッドシートの UI ではかなり厳しい。
そこで、TextAsset の一括編集画面を用意し、ここで YAML 形式での一括編集を行うことができるようにする。
特に、この機能で出力されたテキストを、直接テキストエディタで編集したり、あるいは生成 AI を使って一括で編集させることができるような用途を想定している。

ボタンをクリックすると、以下のような画面が表示される。

```
  ┌───────────────────────────────────────────────────────────┐ 
  │                                   ┌────────────────────┐  │ 
  │   What is this [?]                │  Copy AI Prompt ✨ │  │ 
  │                                   └────────────────────┘  │ 
  │  ┌─────────────────────────────────────────────────────┐  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │    yaml                                             │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  │                                                     │  │ 
  │  └─────────────────────────────────────────────────────┘  │ 
  │                              ┌───────────┐ ┌───────────┐  │ 
  │                              │   Import  │ │  Cancel   │  │ 
  │                              └───────────┘ └───────────┘  │ 
  └───────────────────────────────────────────────────────────┘ 
```

上記の yaml の部分は編集可能なテキストボックス担っている。
デフォルトでは、以下のような形式でプロジェクト内部の TextAssetInstance の内容だけが表示される。

```
pages:
- id: page-xxxxx
  instance-xxxx:
    name: Character1
    ja: |
      こんにちは
    en: |
      Hello
    zh: |
      你好
  instance-yyyy:
    name: Character2
    ja: |
      お元気ですか？
    en: |
      How are you?
    zh: |
      你好吗？
- id: page-xxxxx
  // ...
```

テキストボックス内部に編集が行われた場合、`Import` ボタンが有効化される。
Import ボタンをクリックすると、テキストボックス内の内容がプロジェクト内の TextAssetInstance に反映される。

「Copy AI Prompt」ボタンをクリックすると、AI による一括編集のためのプロンプトがクリップボードにコピーされる。

```
以下の YAML テキストを編集してください。この YAML テキストは、ビジュアルノベルプロジェクトのセリフの設定ファイルとして使われます。有効なYAMLフォーマットを保つように「TODO」の箇所を、その言語コードの表す言語の文章に変更してください。YAMLの「languages」の箇所に、文字コードがどの国の言語を表すかを記載しています。また、「pages」の配列要素のそれぞれがページをあらわし、先頭にある要素ほど前半のページです。各ページの`instance-`で開始するキーは、一つの文章のまとまりです。`name`要素には、そのまとまりの参考となる文脈が含まれている場合があります。`instance-`直下には国コードのキーが存在し、翻訳文が含まれます。すでに存在する翻訳文を参考にしてTODOの箇所を翻訳してください。翻訳が正確で、そのページ自体の文脈だけでなく、前後の文脈を踏まえて適切な翻訳であることを確認してください。文章のブロックは横幅の調整のために改行を含んでいる場合があります。翻訳文も同じような文章幅を保つように適宜改行をいれてください。


\`\`\`yaml
languages:
- ja:Japanese
- en:English
- zh:Chinese
- kr:Korean
- it:Italian
  
pages:
- id: page-xxxxx
  instance-xxxx:
    name: Character1
    ja: |
      こんにちは
    en: |
      Hello
    zh: |
      你好
    kr: TODO
    it: TODO
  instance-yyyy:
    name: Character2
    ja: |
      お元気ですか？
    en: |
      How are you?
    zh: |
      你好吗？
    kr: TODO
    it: TODO
\`\`\`
```

## Implementation Details

### Technical Architecture
- **状態管理**：Zustand store (`projectStore.ts`) で `showAssetLibrary` と `showPreview` を管理
- **レイアウト**：CSS Grid を使用し、パネル表示状態に応じて動的にカラムを調整
- **アイコン**：SVGコンポーネントとして実装し、React内で再利用可能

### Key Files
- `MainLayout.tsx`：メインレイアウトとパネル切り替えロジック
- `AssetLibrary.tsx`：アセットライブラリコンポーネント（閉じるボタン・スクロール機能含む）
- `PreviewArea.tsx`：プレビューエリアコンポーネント（閉じるボタン・フィット機能・パン操作含む）
- `EnhancedSpreadsheet.tsx`：ページ管理機能が統合されたスプレッドシート（スクロール・パン機能含む）
- `PanelIcons.tsx`：SVGアイコンコンポーネント（FitToViewIcon含む）
- `MainLayout.css`：動的レイアウトスタイル
- `App.css`：共通スクロールバースタイル（.scrollbar-largeクラス）

### macOS Compatibility
- **タイトルバースタイル**：`default` を使用してウィンドウ操作の互換性を確保
- **コンテンツマージン**：システムタイトルバーとの重複を回避するよう調整

### Layout States
1. **フル表示**：全パネル表示 (`grid-template-columns: 280px 1fr 320px`)
2. **Asset非表示**：中央＋Preview (`grid-template-columns: 1fr 320px`)
3. **Preview非表示**：Asset＋中央 (`grid-template-columns: 280px 1fr`)
4. **フルスクリーン**：中央のみ (`grid-template-columns: 1fr`)

### Scrolling & Navigation
- **統一スクロールバー**：`.scrollbar-large`クラスによる一貫したスクロールバースタイル
- **動的表示**：コンテンツが領域を超える場合のみスクロールバーを表示（`overflow-y: auto`）
- **レスポンシブ幅制御**：スプレッドシートは画面幅に応じて動的に最大幅を調整
- **パン操作**：マウス中ボタンによる直感的なナビゲーション（スプレッドシート・プレビュー両対応）
